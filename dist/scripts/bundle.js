!function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){var h="function"==typeof require&&require;if(!a&&h)return h(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return r(i?i:t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t){"use strict";var e=t("domready"),i=t("pex-sys"),n=t("pex-glu"),r=t("pex-materials"),o=t("pex-color"),s=t("pex-gen");e(function(){var t=s.Cube,e=n.Mesh,a=r.ShowNormals,h=n.PerspectiveCamera,u=n.Arcball,c=o.Color,l=i.Platform;i.Window.create({settings:{width:1280,height:720,type:"3d",fullscreen:l.isBrowser?!0:!1},init:function(){var i=new t;this.mesh=new e(i,new a),this.camera=new h(60,this.width/this.height),this.arcball=new u(this,this.camera)},draw:function(){n.clearColorAndDepth(c.Red),n.enableDepthReadAndWrite(!0),this.mesh.draw(this.camera)}})})},{domready:5,"pex-color":6,"pex-gen":9,"pex-glu":42,"pex-materials":59,"pex-sys":77}],2:[function(){},{}],3:[function(t,e,i){(function(t){function e(t,e){for(var i=0,n=t.length-1;n>=0;n--){var r=t[n];"."===r?t.splice(n,1):".."===r?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return r.exec(t).slice(1)};i.resolve=function(){for(var i="",r=!1,o=arguments.length-1;o>=-1&&!r;o--){var s=o>=0?arguments[o]:t.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");s&&(i=s+"/"+i,r="/"===s.charAt(0))}return i=e(n(i.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+i||"."},i.normalize=function(t){var r=i.isAbsolute(t),o="/"===s(t,-1);return t=e(n(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&o&&(t+="/"),(r?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(n(t,function(t){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var r=n(t.split("/")),o=n(e.split("/")),s=Math.min(r.length,o.length),a=s,h=0;s>h;h++)if(r[h]!==o[h]){a=h;break}for(var u=[],h=a;h<r.length;h++)u.push("..");return u=u.concat(o.slice(a)),u.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=o(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=o(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return o(t)[3]};var s="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return 0>e&&(e=t.length+e),t.substr(e,i)}}).call(this,t("_process"))},{_process:4}],4:[function(t,e){function i(){if(!s){s=!0;for(var t,e=o.length;e;){t=o,o=[];for(var i=-1;++i<e;)t[i]();e=o.length}s=!1}}function n(){}var r=e.exports={},o=[],s=!1;r.nextTick=function(t){o.push(t),s||setTimeout(i,0)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.on=n,r.addListener=n,r.once=n,r.off=n,r.removeListener=n,r.removeAllListeners=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},{}],5:[function(t,e){!function(t,i){"undefined"!=typeof e?e.exports=i():"function"==typeof define&&"object"==typeof define.amd?define(i):this[t]=i()}("domready",function(){var t,e=[],i=document,n=i.documentElement.doScroll,r="DOMContentLoaded",o=(n?/^loaded|^c/:/^loaded|^i|^c/).test(i.readyState);return o||i.addEventListener(r,t=function(){for(i.removeEventListener(r,t),o=1;t=e.shift();)t()}),function(t){o?t():e.push(t)}})},{}],6:[function(t,e){e.exports.Color=t("./lib/Color")},{"./lib/Color":7}],7:[function(t,e){function i(t,e,i,n){this.r=void 0!==t?t:0,this.g=void 0!==e?e:0,this.b=void 0!==i?i:0,this.a=void 0!==n?n:1}var n=t("lerp");i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromRGB=i.create,i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.fromByteArray=function(t){return new i(t[0]/255,t[1]/255,t[2]/255,4==t.length?t[3]/255:255)},i.fromHSV=function(t,e,n,r){var o=new i;return o.setHSV(t,e,n,r),o},i.fromHSL=function(t,e,n,r){var o=new i;return o.setHSL(t,e,n,r),o},i.fromHex=function(t){var e=new i;return e.setHex(t),e},i.fromXYZ=function(t,e,n){var r=new i;return r.setXYZ(t,e,n),r},i.fromLab=function(t,e,n){var r=new i;return r.setLab(t,e,n),r},i.prototype.set=function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=void 0!==n?n:1,this},i.prototype.setHSV=function(t,e,i,n){n=n||1;var r=Math.floor(6*t),o=6*t-r,s=i*(1-e),a=i*(1-o*e),h=i*(1-(1-o)*e);switch(r%6){case 0:this.r=i,this.g=h,this.b=s;break;case 1:this.r=a,this.g=i,this.b=s;break;case 2:this.r=s,this.g=i,this.b=h;break;case 3:this.r=s,this.g=a,this.b=i;break;case 4:this.r=h,this.g=s,this.b=i;break;case 5:this.r=i,this.g=s,this.b=a}return this.a=n,this},i.prototype.getHSV=function(){var t,e=this.r,i=this.g,n=this.b,r=Math.max(e,i,n),o=Math.min(e,i,n),s=r,a=r-o,h=0===r?0:a/r;if(r===o)t=0;else{switch(r){case e:t=(i-n)/a+(n>i?6:0);break;case i:t=(n-e)/a+2;break;case n:t=(e-i)/a+4}t/=6}return{h:t,s:h,v:s,a:this.a}},i.prototype.setHSL=function(t,e,i,n){function r(t,e,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?t+6*(e-t)*i:.5>i?e:2/3>i?t+(e-t)*(2/3-i)*6:t}if(n=n||1,0===e)this.r=this.g=this.b=i;else{var o=.5>i?i*(1+e):i+e-i*e,s=2*i-o;this.r=r(s,o,t+1/3),this.g=r(s,o,t),this.b=r(s,o,t-1/3),this.a=n}return this},i.prototype.getHSL=function(){var t,e,i=this.r,n=this.g,r=this.b,o=Math.max(i,n,r),s=Math.min(i,n,r),a=(o+s)/2;if(o===s)t=e=0;else{var h=o-s;switch(e=a>.5?h/(2-o-s):h/(o+s),o){case i:t=(n-r)/h+(r>n?6:0);break;case n:t=(r-i)/h+2;break;case r:t=(i-n)/h+4}t/=6}return{h:t,s:e,l:a,a:this.a}},i.prototype.setHex=function(t){t=t.replace(/^#/,"");var e=parseInt(t,16),i=[e>>16,e>>8&255,255&e].map(function(t){return t/255});return this.r=i[0],this.g=i[1],this.b=i[2],this},i.prototype.getHex=function(){var t=[this.r,this.g,this.b].map(function(t){return Math.floor(255*t)});return"#"+(t[2]|t[1]<<8|t[0]<<16|1<<24).toString(16).slice(1).toUpperCase()},i.prototype.setXYZ=function(t,e,i){var n={r:3.2406*t+-1.5372*e+i*-.4986,g:t*-.9689+1.8758*e+.0415*i,b:.0557*t+e*-.204+1.057*i};return["r","g","b"].forEach(function(t){n[t]/=100,n[t]<0&&(n[t]=0),n[t]>.0031308?n[t]=1.055*Math.pow(n[t],1/2.4)-.055:n[t]*=12.92}),this.r=n.r,this.g=n.g,this.b=n.b,this.a=1,this},i.prototype.getXYZ=function(){var t=this.clone();return["r","g","b"].forEach(function(e){t[e]>.04045?t[e]=Math.pow((t[e]+.055)/1.055,2.4):t[e]/=12.92,t[e]=100*t[e]}),{x:.4124*t.r+.3576*t.g+.1805*t.b,y:.2126*t.r+.7152*t.g+.0722*t.b,z:.0193*t.r+.1192*t.g+.9505*t.b}},i.prototype.setLab=function(t,e,n){var r,o=(t+16)/116,s=e/500+o,a=o-n/200,h={x:s,y:o,z:a};["x","y","z"].forEach(function(t){r=Math.pow(h[t],3),h[t]=r>.008856?r:(h[t]-16/116)/7.787});var u=i.fromXYZ(h.x,h.y,h.z);return this.r=u.r,this.g=u.g,this.b=u.b,this.a=u.a,this},i.prototype.getLab=function(){var t={x:95.047,y:100,z:108.883},e=this.getXYZ();return["x","y","z"].forEach(function(i){e[i]/=t[i],e[i]=e[i]>.008856?Math.pow(e[i],1/3):7.787*e[i]+16/116}),{l:116*e.y-16,a:500*(e.x-e.y),b:200*(e.y-e.z)}},i.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},i.prototype.clone=function(){return new i(this.r,this.g,this.b,this.a)},i.prototype.hash=function(){return 1*this.r+12*this.g+123*this.b+1234*this.a},i.prototype.distance=function(t){var e=this.getLab(),i=t.getLab(),n=i.l-e.l,r=i.a-e.a,o=i.b-e.b;return Math.sqrt(n*n,r*r,o*o)},i.lerp=function(t,e,r,o){if(o=o||"rgb","rgb"===o)return i.fromRGB(n(t.r,e.r,r),n(t.g,e.g,r),n(t.b,e.b,r),n(t.a,e.a,r));if("hsv"===o){var s=t.getHSV(),a=e.getHSV();return i.fromHSV(n(s.h,a.h,r),n(s.s,a.s,r),n(s.v,a.v,r),n(s.a,a.a,r))}if("hsl"===o){var h=t.getHSL(),u=e.getHSL();return i.fromHSL(n(h.h,u.h,r),n(h.s,u.s,r),n(h.l,u.l,r),n(h.a,u.a,r))}return t},i.Transparent=new i(0,0,0,0),i.None=new i(0,0,0,0),i.Black=new i(0,0,0,1),i.White=new i(1,1,1,1),i.DarkGrey=new i(.25,.25,.25,1),i.Grey=new i(.5,.5,.5,1),i.LightGrey=new i(.75,.75,.75,1),i.Red=new i(1,0,0,1),i.Green=new i(0,1,0,1),i.Blue=new i(0,0,1,1),i.Yellow=new i(1,1,0,1),i.Pink=new i(1,0,1,1),i.Cyan=new i(0,1,1,1),i.Orange=new i(1,.5,0,1),e.exports=i},{lerp:8}],8:[function(t,e){function i(t,e,i){return t*(1-i)+e*i}e.exports=i},{}],9:[function(t,e){e.exports.Plane=t("./lib/Plane"),e.exports.Cube=t("./lib/Cube"),e.exports.Box=t("./lib/Box"),e.exports.Sphere=t("./lib/Sphere"),e.exports.Tetrahedron=t("./lib/Tetrahedron"),e.exports.Octahedron=t("./lib/Octahedron"),e.exports.Icosahedron=t("./lib/Icosahedron"),e.exports.Dodecahedron=t("./lib/Dodecahedron"),e.exports.HexSphere=t("./lib/HexSphere"),e.exports.LineBuilder=t("./lib/LineBuilder"),e.exports.Loft=t("./lib/Loft"),e.exports.IsoSurface=t("./lib/IsoSurface"),e.exports.Cylinder=t("./lib/Cylinder")},{"./lib/Box":10,"./lib/Cube":11,"./lib/Cylinder":12,"./lib/Dodecahedron":13,"./lib/HexSphere":14,"./lib/Icosahedron":15,"./lib/IsoSurface":16,"./lib/LineBuilder":17,"./lib/Loft":18,"./lib/Octahedron":19,"./lib/Plane":20,"./lib/Sphere":21,"./lib/Tetrahedron":22}],10:[function(t,e){function i(t,e,i){t=null!=t?t:1,e=null!=e?e:null!=t?t:1,i=null!=i?i:null!=t?t:1,o.call(this,{vertices:!0,faces:!0});var n=this.vertices,s=this.faces,a=t/2,h=e/2,u=i/2;n.push(new r(-a,-h,-u)),n.push(new r(-a,-h,u)),n.push(new r(a,-h,u)),n.push(new r(a,-h,-u)),n.push(new r(-a,h,-u)),n.push(new r(-a,h,u)),n.push(new r(a,h,u)),n.push(new r(a,h,-u)),s.push([0,3,2,1]),s.push([4,5,6,7]),s.push([0,1,5,4]),s.push([2,3,7,6]),s.push([1,2,6,5]),s.push([3,0,4,7]),this.computeNormals()}var n=t("pex-geom"),r=(n.Vec2,n.Vec3),o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":24}],11:[function(t,e){function i(t,e,i,n,a,h){function u(t,e,i,n,s,a,h,u,g,m){for(var x=d,v=0;h>=v;v++)for(var y=0;a>=y;y++)vert=c[d]=o.create(),vert[t]=(-n/2+y*n/a)*g,vert[e]=(-s/2+v*s/h)*m,vert[i]=u,normal=p[d]=o.create(),normal[t]=0,normal[e]=0,normal[i]=u/Math.abs(u),texCoord=l[d]=r.create(),texCoord.x=y/a,texCoord.y=1-v/h,++d;for(var v=0;h-1>=v;v++)for(var y=0;a-1>=y;y++){var w=x+v*(a+1)+y;f.push([w,w+a+1,w+a+2,w+1])}}t=null!=t?t:1,e=null!=e?e:null!=t?t:1,i=null!=i?i:null!=t?t:1,n=n||1,a=a||1,h=h||1,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});var c=this.vertices,l=this.texCoords,p=this.normals,f=this.faces,d=0;u("x","y","z",t,e,n,a,i/2,1,-1),u("x","y","z",t,e,n,a,-i/2,-1,-1),u("z","y","x",i,e,h,a,-t/2,1,-1),u("z","y","x",i,e,h,a,t/2,-1,-1),u("x","z","y",t,i,n,h,e/2,1,1),u("x","z","y",t,i,n,h,-e/2,1,-1),this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":24}],12:[function(t,e){function i(t,e,i,n,a,h,u,c){e=null!=e?e:.5,t=null!=t?t:.5,i=null!=i?i:1,n=null!=n?n:8,a=null!=a?a:4,h=null!=h?h:!0,u=null!=u?u:!0,c=null!=c?c:!0,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});var l=this.vertices,p=this.texCoords,f=this.normals,d=this.faces,g=0,m=-i/2;c||(m=0);for(var x=0;a>=x;x++)for(var v=0;n>=v;v++){var y=t+(e-t)*x/a,w=m+i*x/a,b=y*Math.cos(v/n*Math.PI*2),E=y*Math.sin(v/n*Math.PI*2);l.push(new o(b,w,E)),f.push(new o(b,0,E)),p.push(new r(v/n,x/a)),n>v&&a>x&&d.push([g+1,g,g+n+1,g+n+1+1]),g++}if(h){l.push(new o(0,m,0)),f.push(new o(0,-1,0)),p.push(new r(0,0));var M=g;g++;for(var v=0;n>=v;v++){var w=m,b=t*Math.cos(v/n*Math.PI*2),E=t*Math.sin(v/n*Math.PI*2);l.push(new o(b,w,E)),n>v&&d.push([g,g+1,M]),f.push(new o(0,-1,0)),p.push(new r(0,0)),g++}}if(u){l.push(new o(0,m+i,0)),f.push(new o(0,1,0)),p.push(new r(0,0));var M=g;g++;for(var v=0;n>=v;v++){var w=m+i,b=e*Math.cos(v/n*Math.PI*2),E=e*Math.sin(v/n*Math.PI*2);l.push(new o(b,w,E)),n>v&&d.push([g+1,g,M]),f.push(new o(0,1,0)),p.push(new r(1,1)),g++}}this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":24}],13:[function(t,e){function i(t){t=t||.5;var e=(1+Math.sqrt(5))/2,i=.5,n=.5/e,s=.5*(2-e),a=[new r(s,0,i),new r(-s,0,i),new r(-n,n,n),new r(0,i,s),new r(n,n,n),new r(n,-n,n),new r(0,-i,s),new r(-n,-n,n),new r(s,0,-i),new r(-s,0,-i),new r(-n,-n,-n),new r(0,-i,-s),new r(n,-n,-n),new r(n,n,-n),new r(0,i,-s),new r(-n,n,-n),new r(i,s,0),new r(-i,s,0),new r(-i,-s,0),new r(i,-s,0)];a=a.map(function(e){return e.normalize().scale(t)});var h=[[4,3,2,1,0],[7,6,5,0,1],[12,11,10,9,8],[15,14,13,8,9],[14,3,4,16,13],[3,14,15,17,2],[11,6,7,18,10],[6,11,12,19,5],[4,0,5,19,16],[12,8,13,16,19],[15,9,10,18,17],[7,1,2,17,18]],u=[[0,1],[0,4],[0,5],[1,2],[1,7],[2,3],[2,17],[3,4],[3,14],[4,16],[5,6],[5,19],[6,7],[6,11],[7,18],[8,9],[8,12],[8,13],[9,10],[9,15],[10,11],[10,18],[11,12],[12,19],[13,14],[13,16],[14,15],[15,17],[16,19],[17,18]];o.call(this,{vertices:a,faces:h,edges:u})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":24}],14:[function(t,e){function i(t,e){t=t||.5,e=e||1;for(var i=new c(t),n=0;e>n;n++)i=i.subdivideEdges();var a=[],h=[],l=[],p=i.computeHalfEdges();p.forEach(function(t){l[t.face[t.slot]]=t});for(var n=0;n<i.vertices.length;n++){var f=a.length,d=[];r(l[n],function(t){var e=o(s(i.vertices,t.face));d.push(e)}),d.forEach(function(t){a.push(t)}),5==d.length&&h.push([f,f+1,f+2,f+3,f+4]),6==d.length&&h.push([f,f+1,f+2,f+3,f+4,f+5])}a.forEach(function(e){e.normalize().scale(t)}),u.call(this,{vertices:a,faces:h}),this.computeEdges()}function n(t){return t.face.halfEdges[(t.slot-1+t.face.length)%t.face.length]}function r(t,e){var i=t;do e(i),i=n(i).opposite;while(i!=t)}function o(t){var e=(t.length,t.reduce(function(t,e){return t.add(e)},new h(0,0,0)));return e.scale(1/t.length),e}function s(t,e){return e.map(function(e){return t[e]})}var a=t("pex-geom"),h=a.Vec3,u=a.Geometry,c=t("./Icosahedron");i.prototype=Object.create(u.prototype),e.exports=i},{"./Icosahedron":15,"pex-geom":24}],15:[function(t,e){function i(t){t=t||.5;var e=(1+Math.sqrt(5))/2,i=.5,n=1/(2*e),s=[new r(0,n,-i),new r(n,i,0),new r(-n,i,0),new r(0,n,i),new r(0,-n,i),new r(-i,0,n),new r(i,0,n),new r(0,-n,-i),new r(i,0,-n),new r(-i,0,-n),new r(n,-i,0),new r(-n,-i,0)];s=s.map(function(e){return e.normalize().scale(t)});var a=[[1,0,2],[2,3,1],[4,3,5],[6,3,4],[7,0,8],[9,0,7],[10,4,11],[11,7,10],[5,2,9],[9,11,5],[8,1,6],[6,10,8],[5,3,2],[1,3,6],[2,0,9],[8,0,1],[9,7,11],[10,7,8],[11,4,5],[6,4,10]],h=[[0,1],[0,2],[0,7],[0,8],[0,9],[1,2],[1,3],[1,6],[1,8],[2,3],[2,5],[2,9],[3,4],[3,5],[3,6],[4,5],[4,6],[4,10],[4,11],[5,9],[5,11],[6,8],[6,10],[7,8],[7,9],[7,10],[7,11],[8,10],[9,11],[10,11]];o.call(this,{vertices:s,faces:a,edges:h})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":24}],16:[function(t,e){function i(t,e){e=e||1,this.numOfGridPts=t||16,this.tresholdValue=1,this.makeGrid(e),s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0})}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),i.prototype.update=function(t){for(var e=this.grid,i=0;i<this.numOfGridPts;i++)for(var n=0;n<this.numOfGridPts;n++)for(var r=0;r<this.numOfGridPts;r++)e[i][n][r].value=this.findValue(e[i][n][r].position,t);for(i=1;i<this.numOfGridPts-1;i++)for(n=1;n<this.numOfGridPts-1;n++)for(r=1;r<this.numOfGridPts-1;r++)e[i][n][r].normal.x=e[i-1][n][r].value-e[i+1][n][r].value,e[i][n][r].normal.y=e[i][n-1][r].value-e[i][n+1][r].value,e[i][n][r].normal.z=e[i][n][r-1].value-e[i][n][r+1].value;for(i=0;i<this.numOfGridPts;i++){var o=i;for(0==i?o+=1:i==this.numOfGridPts-1&&(o-=1),n=0;n<this.numOfGridPts;n++){var s=n;for(0==n?s+=1:n==this.numOfGridPts-1&&(s-=1),r=0;r<this.numOfGridPts;r++){var a=r;0==r?a+=1:r==this.numOfGridPts-1&&(a-=1),e[i][n][r].normal.x=e[o][s][a].normal.x,e[i][n][r].normal.y=e[o][s][a].normal.y,e[i][n][r].normal.z=e[o][s][a].normal.z}}}this.vertices.length=0,this.normals.length=0,this.texCoords.length=0,this.faces.length=0,this.vertices.dirty=!0,this.normals.dirty=!0,this.texCoords.dirty=!0,this.faces.dirty=!0;for(var i=0;i<this.numOfGridPts-1;i++)for(var n=0;n<this.numOfGridPts-1;n++)for(var r=0;r<this.numOfGridPts-1;r++)this.marchCube(i,n,r);return this},i.prototype.makeGrid=function(t){2/(this.numOfGridPts-1);this.grid=[];for(var e=0;e<this.numOfGridPts;e++){this.grid[e]=[];for(var i=0;i<this.numOfGridPts;i++){this.grid[e][i]=[];for(var n=0;n<this.numOfGridPts;n++)this.grid[e][i][n]={value:0,position:new o((e/(this.numOfGridPts-1)-.5)*t,(i/(this.numOfGridPts-1)-.5)*t,(n/(this.numOfGridPts-1)-.5)*t),normal:new o(0,0,0)}}}this.cubes=[];for(var e=0;e<this.numOfGridPts-1;e++){this.cubes[e]=[];for(var i=0;i<this.numOfGridPts-1;i++){this.cubes[e][i]=[];for(var n=0;n<this.numOfGridPts-1;n++)this.cubes[e][i][n]={vert:[]},this.cubes[e][i][n].vert[0]=this.grid[e][i][n],this.cubes[e][i][n].vert[1]=this.grid[e+1][i][n],this.cubes[e][i][n].vert[2]=this.grid[e+1][i][n+1],this.cubes[e][i][n].vert[3]=this.grid[e][i][n+1],this.cubes[e][i][n].vert[4]=this.grid[e][i+1][n],this.cubes[e][i][n].vert[5]=this.grid[e+1][i+1][n],this.cubes[e][i][n].vert[6]=this.grid[e+1][i+1][n+1],this.cubes[e][i][n].vert[7]=this.grid[e][i+1][n+1]}}},i.prototype.marchCube=function(t,e,i){var n,o,s,u,c=0,l=[{},{},{},{},{},{},{},{},{},{},{},{}],p=this.cubes[t][e][i];if(p.vert[0].value>this.tresholdValue&&(c|=1),p.vert[1].value>this.tresholdValue&&(c|=2),p.vert[2].value>this.tresholdValue&&(c|=4),p.vert[3].value>this.tresholdValue&&(c|=8),p.vert[4].value>this.tresholdValue&&(c|=16),p.vert[5].value>this.tresholdValue&&(c|=32),p.vert[6].value>this.tresholdValue&&(c|=64),p.vert[7].value>this.tresholdValue&&(c|=128),n=a[c],0!=n){1&n&&this.interpolate(p.vert[0],p.vert[1],l[0]),2&n&&this.interpolate(p.vert[1],p.vert[2],l[1]),4&n&&this.interpolate(p.vert[2],p.vert[3],l[2]),8&n&&this.interpolate(p.vert[3],p.vert[0],l[3]),16&n&&this.interpolate(p.vert[4],p.vert[5],l[4]),32&n&&this.interpolate(p.vert[5],p.vert[6],l[5]),64&n&&this.interpolate(p.vert[6],p.vert[7],l[6]),128&n&&this.interpolate(p.vert[7],p.vert[4],l[7]),256&n&&this.interpolate(p.vert[0],p.vert[4],l[8]),512&n&&this.interpolate(p.vert[1],p.vert[5],l[9]),1024&n&&this.interpolate(p.vert[2],p.vert[6],l[10]),2048&n&&this.interpolate(p.vert[3],p.vert[7],l[11]);var f=this.vertices.length;for(o=0;5>o&&!(h[c][3*o]<0);o++){for(var d=l[h[c][3*o+1]].position.dup().sub(l[h[c][3*o+0]].position),g=l[h[c][3*o+2]].position.dup().sub(l[h[c][3*o+0]].position),s=(d.dup().cross(g),0);3>s;s++)u=l[h[c][3*o+s]],this.vertices.push(u.position),this.normals.push(u.normal),this.texCoords.push(new r(.5*u.normal.x+.5,.5*u.normal.y+.5));this.faces.push([f++,f++,f++])}}},i.prototype.interpolate=function(t,e,i){var n=e.value-t.value;0==n&&(n=0);var r=(this.tresholdValue-t.value)/n;i.position=t.position.dup().add(e.position.dup().sub(t.position).dup().scale(r)),i.normal=t.normal.dup().add(e.normal.dup().sub(t.normal).dup().scale(r));var o=i.normal.length();o=0==o?1:1/o,i.normal=i.normal.dup().scale(o)},i.prototype.findValue=function(t,e){for(var i=0,n=0;n<e.length;n++){var r=t.squareDistance(e[n].position);0==r&&(len=1);var o=e[n].radius,s=e[n].force;i+=s*o*o*e[n].radius/r}return i};var a=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],h=[[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1],[3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1],[3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1],[3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1],[9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1],[9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1],[2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1],[8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1],[9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1],[4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1],[3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1],[1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1],[4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1],[4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1],[9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1],[1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1],[5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1],[2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1],[9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1],[0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1],[2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1],[10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1],[4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1],[5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1],[5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1],[9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1],[0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1],[1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1],[10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1],[8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1],[2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1],[7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1],[9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1],[2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1],[11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1],[9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1],[11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1],[1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1],[9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1],[5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1],[2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1],[0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1],[5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1],[6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1],[0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1],[3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1],[6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1],[5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1],[1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1],[10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1],[6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1],[1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1],[8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1],[3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1],[5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1],[0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1],[8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1],[6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1],[10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1],[10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1],[8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1],[1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1],[3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1],[0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1],[10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1],[0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1],[3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1],[9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1],[3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1],[6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1],[0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1],[10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1],[10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1],[1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1],[7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1],[7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1],[11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1],[0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1],[7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1],[10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1],[2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1],[6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1],[7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1],[2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1],[1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1],[10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1],[10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1],[0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1],[7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1],[6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1],[8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1],[9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1],[6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1],[4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1],[8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1],[0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1],[1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1],[8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1],[10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1],[10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1],[5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1],[11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1],[9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1],[6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1],[7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1],[7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1],[9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1],[3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1],[9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1],[7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1],[6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1],[3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1],[0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1],[6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1],[1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1],[6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1],[5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1],[9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1],[1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1],[10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1],[0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1],[5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1],[10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1],[11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1],[0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1],[9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1],[2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1],[8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1],[9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1],[1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1],[9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1],[9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1],[5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1],[0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1],[2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1],[9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1],[5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1],[5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1],[8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1],[0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1],[9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1],[0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1],[1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1],[4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1],[11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1],[11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1],[2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1],[1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1],[4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1],[4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1],[0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1],[3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1],[3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1],[0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1],[9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1],[1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]];e.exports=i},{"pex-geom":24}],17:[function(t,e){function i(){o.call(this,{vertices:!0,colors:!0})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),i.prototype.addLine=function(t,e,i,n){return i=i||{r:1,g:1,b:1,a:1},n=n||i,this.vertices.push(r.create().copy(t)),this.vertices.push(r.create().copy(e)),this.colors.push(i),this.colors.push(n),this.vertices.dirty=!0,this.colors.dirty=!0,this},i.prototype.addPath=function(t,e,i,n){i=i||t.points.length,e=e||{r:1,g:1,b:1,a:1},n=n||!1;
var r=t.getPointAt(0);n&&this.addCross(r,.1,e);for(var o=1;i>o;o++){var s;s=t.points.length==i?t.getPoint(o/(i-1)):t.getPointAt(o/(i-1)),this.addLine(r,s,e),r=s,n&&this.addCross(r,.1,e)}return this.vertices.dirty=!0,this.colors.dirty=!0,this},i.prototype.addCross=function(t,e,i){e=e||.1;var n=e/2;return i=i||{r:1,g:1,b:1,a:1},this.vertices.push(r.create().set(t.x-n,t.y,t.z)),this.vertices.push(r.create().set(t.x+n,t.y,t.z)),this.vertices.push(r.create().set(t.x,t.y-n,t.z)),this.vertices.push(r.create().set(t.x,t.y+n,t.z)),this.vertices.push(r.create().set(t.x,t.y,t.z-n)),this.vertices.push(r.create().set(t.x,t.y,t.z+n)),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this.colors.push(i),this},i.prototype.reset=function(){return this.vertices.length=0,this.colors.length=0,this.vertices.dirty=!0,this.colors.dirty=!0,this},e.exports=i},{"pex-geom":24}],18:[function(t,e){function i(t,e){e=e||{},s.call(this,{vertices:!0,normals:!0,texCoords:!0,edges:!1,faces:!0});var i={numSteps:200,numSegments:8,r:1,shapePath:null,xShapeScale:1,caps:!1,initialNormal:null};t.samplesCount=5e3,e.shapePath&&!e.numSegments&&(e.numSegments=e.shapePath.points.length),this.options=e=r(i,e),this.path=t,t.isClosed()&&(e.caps=!1),this.shapePath=e.shapePath||this.makeShapePath(e.numSegments),this.rfunc=this.makeRadiusFunction(e.r),this.rufunc=e.ru?this.makeRadiusFunction(e.ru):this.rfunc,this.rvfunc=e.rv?this.makeRadiusFunction(e.rv):e.ru?this.rufunc:this.rfunc,this.points=this.samplePoints(t,e.numSteps,t.isClosed()),this.tangents=this.sampleTangents(t,e.numSteps,t.isClosed()),this.frames=this.makeFrames(this.points,this.tangents,t.isClosed()),this.buildGeometry(e.caps)}function n(t,e,i){return Math.max(e,Math.min(t,i))}var r=t("merge"),o=t("pex-geom"),s=o.Geometry,a=o.Vec2,h=o.Vec3,u=o.Mat4,c=o.Quat,l=o.Path,f=o.Spline1D,d=(o.Spline3D,Math.acos),g=Math.PI,m=(Math.min,t("./LineBuilder")),x=1e-5;i.prototype=Object.create(s.prototype),i.prototype.buildGeometry=function(t){t="undefined"!=typeof t?t:!1;for(var e=0,i=this.options.numSteps,n=this.options.numSegments,r=0;r<this.frames.length;r++)for(var o=this.frames[r],s=this.rufunc(r,i),h=this.rvfunc(r,i),u=0;n>u;u++)p=n==this.shapePath.points.length?this.shapePath.getPoint(u/(n-1)):this.shapePath.getPointAt(u/(n-1)),p.x*=s,p.y*=h,p=p.transformMat4(o.m).add(o.position),this.vertices.push(p),this.texCoords.push(new a(u/n,r/i)),this.normals.push(p.dup().sub(o.position).normalize());t&&(this.vertices.push(this.frames[0].position),this.texCoords.push(new a(0,0)),this.normals.push(this.frames[0].tangent.dup().scale(-1)),this.vertices.push(this.frames[this.frames.length-1].position),this.texCoords.push(new a(0,0)),this.normals.push(this.frames[this.frames.length-1].tangent.dup().scale(-1))),e=0;for(var r=0;r<this.frames.length;r++){for(var u=0;n>u;u++)i-1>r&&this.faces.push([e+(u+1)%n+n,e+(u+1)%n,e+u,e+u+n]);e+=n}if(this.path.isClosed()){e-=n;for(var u=0;n>u;u++)this.faces.push([(u+1)%n,e+(u+1)%n,e+u,u])}if(t)for(var u=0;n>u;u++)this.faces.push([u,(u+1)%n,this.vertices.length-2]),this.faces.push([this.vertices.length-1,e-n+(u+1)%n,e-n+u])},i.prototype.makeShapePath=function(t){for(var e=new l,i=0;t>i;i++){var n=i/t,r=2*n*Math.PI,o=new h(Math.cos(r),Math.sin(r),0);e.addPoint(o)}return e.close(),e},i.prototype.makeFrames=function(t,e,i,r){null==r&&(r=0);var o=e[0],s=Math.abs(o.x),a=Math.abs(o.y),l=Math.abs(o.z),p=null;p=o.dup().cross(l>s&&l>=a?new h(0,1,0):a>s&&a>=l?new h(1,0,0):new h(0,0,1));var f=this.options.initialNormal||h.create().asCross(o,p).normalize(),m=h.create().asCross(o,f).normalize(),v=[],y=new c;p=new h;for(var w=0;w<this.points.length;w++){var b=t[w];o=e[w],w>0&&(f=f.dup(),m=m.dup(),prevTangent=e[w-1],p.asCross(prevTangent,o),p.length()>x&&(p.normalize(),theta=d(prevTangent.dot(o)),y.setAxisAngle(p,180*theta/g),f.transformQuat(y)),m.asCross(o,f));var E=(new u).set4x4r(m.x,f.x,o.x,0,m.y,f.y,o.y,0,m.z,f.z,o.z,0,0,0,0,1);v.push({tangent:o,normal:f,binormal:m,position:b,m:E})}return i&&(firstNormal=v[0].normal,lastNormal=v[v.length-1].normal,theta=Math.acos(n(firstNormal.dot(lastNormal),0,1)),theta/=v.length-1,e[0].dot(p.asCross(firstNormal,lastNormal))>0&&(theta=-theta),v.forEach(function(t,e){y.setAxisAngle(t.tangent,theta*e*180/g),t.normal.transformQuat(y),t.binormal.asCross(t.tangent,t.normal),t.m.set4x4r(t.binormal.x,t.normal.x,t.tangent.x,0,t.binormal.y,t.normal.y,t.tangent.y,0,t.binormal.z,t.normal.z,t.tangent.z,0,0,0,0,1)})),v},i.prototype.samplePoints=function(t,e,i){for(var n=[],r=i?e:e-1,o=0;e>o;o++)n.push(t.getPointAt(o/r));return n},i.prototype.sampleTangents=function(t,e,i){for(var n=[],r=i?e:e-1,o=0;e>o;o++)n.push(t.getTangentAt(o/r));return n},i.prototype.makeRadiusFunction=function(t){var e;return e=t instanceof f?function(e,i){return t.getPointAt(e/(i-1))}:function(){return t}},i.prototype.toDebugLines=function(t){t=t||.5;var e=new m,i={r:1,g:0,b:0,a:1},n={r:0,g:1,b:0,a:1},r={r:0,g:.5,b:1,a:1};return this.frames.forEach(function(o){e.addLine(o.position,o.position.dup().add(o.tangent.dup().scale(t)),i,i),e.addLine(o.position,o.position.dup().add(o.normal.dup().scale(t)),n,n),e.addLine(o.position,o.position.dup().add(o.binormal.dup().scale(t)),r,r)}),e},e.exports=i},{"./LineBuilder":17,merge:23,"pex-geom":24}],19:[function(t,e){function i(t){t=t||.5;var e=1/(2*Math.sqrt(2)),i=.5,n=(Math.sqrt(3),Math.sqrt(6),[new r(-e,0,e),new r(e,0,e),new r(e,0,-e),new r(-e,0,-e),new r(0,i,0),new r(0,-i,0)]);n=n.map(function(e){return e.normalize().scale(t)});var s=[[3,0,4],[2,3,4],[1,2,4],[0,1,4],[3,2,5],[0,3,5],[2,1,5],[1,0,5]],a=[[0,1],[1,2],[2,3],[3,0],[0,4],[1,4],[2,4],[3,4],[0,5],[1,5],[2,5],[3,5]];o.call(this,{vertices:n,faces:s,edges:a})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":24}],20:[function(t,e){function i(t,e,i,n,a,h){t=t||1,e=e||t||1,i=i||1,n=n||i||1,a=a||"x",h=h||"y",s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0,edges:!0});var u=["x","y","z"];u.splice(u.indexOf(a),1),u.splice(u.indexOf(h),1),u=u[0];for(var c=this.vertices,l=this.texCoords,p=this.normals,f=this.faces,d=this.edges,g=c.length,m=0;n>=m;++m)for(var x=0;i>=x;++x){var v=new o;v[a]=-t/2+x*t/i,v[h]=e/2-m*e/n,v[u]=0,c.push(v);var y=new r(x/i,1-m/n);l.push(y);var w=new o;w[a]=0,w[h]=0,w[u]=1,p.push(w)}for(var m=0;n>m;++m)for(var x=0;i>x;++x){var b=g+m*(i+1)+x,E=[b,b+i+1,b+i+2,b+1];d.push([b,b+1]),d.push([b,b+i+1]),m==n-1&&d.push([b+i+1,b+i+2]),x==i-1&&d.push([b+1,b+i+2]),f.push(E)}}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":24}],21:[function(t,e){function i(t,e,i){function n(e,i){var n=new o;return n.x=t*Math.sin(e*l)*Math.sin(i*l),n.y=t*Math.cos(e*l),n.z=t*Math.sin(e*l)*Math.cos(i*l),n}t=t||.5,e=e||36,i=i||18,s.call(this,{vertices:!0,normals:!0,texCoords:!0,faces:!0});for(var a=this.vertices,h=this.texCoords,u=this.normals,c=this.faces,l=1/180*Math.PI,p=360/e,f=180/i,d=0;i>=d;++d)for(var g=d*f,m=0;e>=m;++m){var x=m*p,v=n(g,x),y=v.dup().normalize(),w=new r(x/360,g/180);a.push(v),u.push(y),h.push(w),d!=i&&m!=e&&c.push(0==d?[d*(e+1)+m,(d+1)*(e+1)+m,(d+1)*(e+1)+m+1]:d==i-1?[d*(e+1)+m,(d+1)*(e+1)+m+1,d*(e+1)+m+1]:[d*(e+1)+m,(d+1)*(e+1)+m,(d+1)*(e+1)+m+1,d*(e+1)+m+1])}this.computeEdges()}var n=t("pex-geom"),r=n.Vec2,o=n.Vec3,s=n.Geometry;i.prototype=Object.create(s.prototype),e.exports=i},{"pex-geom":24}],22:[function(t,e){function i(t){t=t||.5;var e=Math.sqrt(3),i=Math.sqrt(6),n=[new r(e/3,-i/3*.333+.025*i,0),new r(-e/6,-i/3*.333+.025*i,.5),new r(-e/6,-i/3*.333+.025*i,-0.5),new r(0,i/3*.666+.025*i,0)];n=n.map(function(e){return e.normalize().scale(t)});var s=[[0,1,2],[3,1,0],[3,0,2],[3,2,1]],a=[[0,1],[0,2],[0,3],[1,2],[1,3],[2,3]];o.call(this,{vertices:n,faces:s,edges:a})}var n=t("pex-geom"),r=n.Vec3,o=n.Geometry;i.prototype=Object.create(o.prototype),e.exports=i},{"pex-geom":24}],23:[function(t,e){!function(t){function i(){var t,e,i,o=Array.prototype.slice.call(arguments),s=o.shift(),a=s===!0,h=o.length;for((a||"object"!==r(s))&&(s={}),e=0;h>e;++e)if("object"===r(t=o[e]))for(i in t)s[i]=a?n(t[i]):t[i];return s}function n(t){var e,i,o=t,s=r(t);if("array"===s)for(o=[],i=t.length,e=0;i>e;++e)o[e]=n(t[e]);else if("object"===s){o={};for(e in t)o[e]=n(t[e])}return o}function r(t){return{}.toString.call(t).match(/\s([\w]+)/)[1].toLowerCase()}t?e.exports=i:window.merge=i}("object"==typeof e&&e&&"object"==typeof e.exports&&e.exports)},{}],24:[function(t,e){e.exports.Vec2=t("./lib/Vec2"),e.exports.Vec3=t("./lib/Vec3"),e.exports.Vec4=t("./lib/Vec4"),e.exports.Mat4=t("./lib/Mat4"),e.exports.Quat=t("./lib/Quat"),e.exports.Path=t("./lib/Path"),e.exports.Rect=t("./lib/Rect"),e.exports.Spline3D=t("./lib/Spline3D"),e.exports.Spline2D=t("./lib/Spline2D"),e.exports.Spline1D=t("./lib/Spline1D"),e.exports.Ray=t("./lib/Ray"),e.exports.Plane=t("./lib/Plane"),e.exports.Geometry=t("./lib/Geometry"),e.exports.BoundingBox=t("./lib/BoundingBox"),e.exports.Triangle2D=t("./lib/Triangle2D"),e.exports.Triangle3D=t("./lib/Triangle3D"),e.exports.Octree=t("./lib/Octree")},{"./lib/BoundingBox":25,"./lib/Geometry":26,"./lib/Mat4":27,"./lib/Octree":28,"./lib/Path":29,"./lib/Plane":30,"./lib/Quat":31,"./lib/Ray":32,"./lib/Rect":33,"./lib/Spline1D":34,"./lib/Spline2D":35,"./lib/Spline3D":36,"./lib/Triangle2D":37,"./lib/Triangle3D":38,"./lib/Vec2":39,"./lib/Vec3":40,"./lib/Vec4":41}],25:[function(t,e){function i(t,e){this.min=t,this.max=e}var n=t("./Vec3");i.fromPositionSize=function(t,e){return new i(n.create(t.x-e.x/2,t.y-e.y/2,t.z-e.z/2),n.create(t.x+e.x/2,t.y+e.y/2,t.z+e.z/2))},i.fromPoints=function(t){var e=new i(t[0].clone(),t[0].clone());return t.forEach(e.addPoint.bind(e)),e},i.prototype.isEmpty=function(){return this.min&&this.max?!1:!0},i.prototype.addPoint=function(t){this.isEmpty()&&(this.min=t.clone(),this.max=t.clone()),t.x<this.min.x&&(this.min.x=t.x),t.y<this.min.y&&(this.min.y=t.y),t.z<this.min.z&&(this.min.z=t.z),t.x>this.max.x&&(this.max.x=t.x),t.y>this.max.y&&(this.max.y=t.y),t.z>this.max.z&&(this.max.z=t.z)},i.prototype.getSize=function(){return n.create(this.max.x-this.min.x,this.max.y-this.min.y,this.max.z-this.min.z)},i.prototype.getCenter=function(){return n.create(this.min.x+(this.max.x-this.min.x)/2,this.min.y+(this.max.y-this.min.y)/2,this.min.z+(this.max.z-this.min.z)/2)},i.prototype.contains=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},e.exports=i},{"./Vec3":40}],26:[function(t,e){function i(t){t=t||{},this.attribs={},t.vertices&&this.addAttrib("vertices","position",t.vertices,!1),t.normals&&this.addAttrib("normals","normal",t.normals,!1),t.texCoords&&this.addAttrib("texCoords","texCoord",t.texCoords,!1),t.tangents&&this.addAttrib("tangents","tangent",t.tangents,!1),t.colors&&this.addAttrib("colors","color",t.colors,!1),t.indices&&this.addIndices(t.indices),t.edges&&this.addEdges(t.edges),t.faces&&this.addFaces(t.faces)}function n(t){var e=(t.length,t.reduce(function(t,e){return t.add(e)},new c(0,0,0)));return e.scale(1/t.length),e}function r(t,e){var i=t,n=0;do e(i,n++),i=s(i);while(i!=t)}function o(t,e){var i=t;do e(i),i=a(i).opposite;while(i!=t)}function s(t){return t.face.halfEdges[(t.slot+1)%t.face.length]}function a(t){return t.face.halfEdges[(t.slot-1+t.face.length)%t.face.length]}function h(t,e){return e.map(function(e){return t[e]})}function u(t,e,i){return e.dup().sub(t).normalize().scale(i).add(t)}var c=t("./Vec3"),l=t("./Ray"),p=t("./BoundingBox");i.prototype.generateVolumePoints=function(t){t=t||5e3;for(var e=p.fromPoints(this.vertices),i=-e.min.x+e.max.x,n=-e.min.y+e.max.y,r=-e.min.z+e.max.z,o=0,s=[],a=[],h=0;!(o>=t);h++){var u=Math.floor(6*Math.random())+1,f=bottomX=(Math.random()-.5)*i,d=(Math.random()+.5)*n,g=bottomZ=(Math.random()-.5)*r,m=-d,x=-(Math.random()+.5)*i,v=rightY=(Math.random()-.5)*n,y=rightZ=(Math.random()-.5)*r,w=-x,b=frontX=(Math.random()-.5)*i,E=frontY=(Math.random()-.5)*n,M=-(Math.random()+.5)*r,T=-M;switch(u){case 1:var P=new c(x,v,y),C=new c(w,rightY,rightZ);break;case 2:var P=new c(w,rightY,rightZ),C=new c(x,v,y);break;case 3:var P=new c(f,d,g),C=new c(bottomX,m,m);break;case 4:var P=new c(bottomX,m,bottomZ),C=new c(f,d,g);break;case 5:var P=new c(b,E,M),C=new c(frontX,frontY,T);break;case 6:var P=new c(frontX,frontY,T),C=new c(b,E,M)}var z=P.dup(),A=C.dup().sub(P).normalize(),R=this.clone().triangulate(),_=0,S=[];if(R.faces.forEach(function(t){var e={};e.a=R.vertices[t[0]],e.b=R.vertices[t[1]],e.c=R.vertices[t[2]];var i=new l(z,A),n=i.hitTestTriangle(e);isNaN(n)&&(o++,_++,S.push(n))}),S.forEach(function(t){_%2===0&&s.push(t)}),!(s.length<2)){var L=s[s.length-2],N=s[s.length-1],D=N.dup().sub(L),B=L.dup().addScaled(D,Math.random());a.push(B)}}return a},i.prototype.generateSurfacePoints=function(t){t=t||5e3;for(var e=[],i=[],n=0,r=this.faces.length;r>n;n++){var o={},s=this.faces[n][0],a=this.faces[n][1],h=this.faces[n][2],u=this.vertices[s],c=this.vertices[a],l=this.vertices[h],p=c.dup().sub(u),f=l.dup().sub(u),d=p.cross(f),g=.5*Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z);o.A=u,o.B=c,o.C=l,i.push(o),e.push(g)}var m=Math.min.apply(Math,e),x=e.map(function(t){return Math.ceil(t/m)}),v=[];x.forEach(function(t,e){for(var i=0;t>i;i++)v.push(e)});for(var y=[],w=0;t>w;w++){var b=Math.ceil(Math.random()*v.length)-1,o=i[v[b]],u=o.A.clone(),c=o.B.clone(),l=o.C.clone(),E=Math.random(),M=Math.random();E+M>1&&(E=1-E,M=1-M);var T=1-(E+M),P=u.dup().scale(E),C=c.dup().scale(M),z=l.dup().scale(T),A=P.add(C).add(z);y.push(A)}return y},i.prototype.addAttrib=function(t,e,i,n,r){return void 0==i&&(i=null),void 0==n&&(n=!1),void 0==r&&(r=!1),this[t]=i&&i.length?i:[],this[t].name=e,this[t].dirty=!0,this[t].dynamic=n,this[t].instanced=r,this.attribs[t]=this[t],this},i.prototype.addFaces=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.faces=t&&t.length?t:[],this.faces.dirty=!0,this.faces.dynamic=!1,this},i.prototype.addEdges=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.edges=t&&t.length?t:[],this.edges.dirty=!0,this.edges.dynamic=!1,this},i.prototype.addIndices=function(t,e){return null==t&&(t=null),null==e&&(e=!1),this.indices=t&&t.length?t:[],this.indices.dirty=!0,this.indices.dynamic=!1,this},i.prototype.isDirty=function(){var t=!1;t||(t=this.faces&&this.faces.dirty),t||(t=this.edges&&this.edges.dirty);for(attribAlias in this.attribs){var e=this.attribs[attribAlias];t||(t=e.dirty)}return t},i.prototype.addEdge=function(t,e){this.edges||this.addEdges(),this.edgeHash||(this.edgeHash={});var i=t+"_"+e,n=e+"_"+t;return this.edgeHash[i]||this.edgeHash[n]?void 0:(this.edges.push([t,e]),this.edgeHash[i]=this.edgeHash[n]=!0)},i.prototype.computeEdges=function(){if(this.edges?(this.edgeHash=null,this.edges.length=0):this.addEdges(),this.faces&&this.faces.length)this.faces.forEach(function(t){for(var e=0;e<t.length;e++)this.addEdge(t[e],t[(e+1)%t.length])}.bind(this));else for(var t=0;t<this.vertices.length-1;t++)this.addEdge(t,t+1)},i.prototype.computeNormals=function(){if(!this.faces)throw"Geometry[2]omputeSmoothNormals no faces found";if(this.normals||this.addAttrib("normals","normal",null,!1),this.normals.length>this.vertices.length)this.normals.length=this.vertices.length;else for(;this.normals.length<this.vertices.length;)this.normals.push(new c(0,0,0));for(var t=this.vertices,e=this.faces,i=this.normals,n=[],r=0;r<t.length;r++)n[r]=0;for(var o=new c,s=new c,a=new c,h=0;h<e.length;h++){var u=e[h],l=t[u[0]],p=t[u[1]],f=t[u[2]];o.asSub(p,l).normalize(),s.asSub(f,l).normalize(),a.asCross(o,s);for(var r=0;r<u.length;r++)i[u[r]].add(a),n[u[r]]++}for(var r=0;r<i.length;r++)i[r].normalize();this.normals.dirty=!0},i.prototype.toFlatGeometry=function(){var t=new i({vertices:!0,faces:!0}),e=this.vertices;return this.faces.forEach(function(i){var n=[];i.forEach(function(i){n.push(t.vertices.length),t.vertices.push(e[i])}),t.faces.push(n)}),t},i.prototype.clone=function(){var t={};return Object.keys(this.attribs).forEach(function(e){var i=this.attribs[e];t[e]=i.map(function(t){return t.dup?t.dup():t})}.bind(this)),t.faces=this.faces.map(function(t){return t.slice(0)}),t.edges=this.edges?this.edges.map(function(t){return t.slice(0)}):null,new i(t)},i.prototype.merge=function(t){var e={};Object.keys(this.attribs).forEach(function(i){var n=this.attribs[i],r=t.attribs[i];r&&(e[i]=[],n.forEach(function(t){e[i].push(t.dup?t.dup():t)}),r.forEach(function(t){e[i].push(t.dup?t.dup():t)}))}.bind(this));var n=this.vertices.length;return this.faces&&t.faces&&(e.faces=[],this.faces.forEach(function(t){e.faces.push(t.slice(0))}),t.faces.forEach(function(t){var i=t.map(function(t){return t+n});e.faces.push(i)})),this.edges&&t.edges&&(e.edges=[],this.edges.forEach(function(t){e.edges.push(t.slice(0))}),t.edges.forEach(function(t){var i=t.map(function(t){return t+n});e.edges.push(i)})),new i(e)},i.prototype.triangulate=function(){var t=this.clone();return t.faces=[],this.faces.forEach(function(e){t.faces.push([e[0],e[1],e[2]]);for(var i=2;i<e.length-1;i++)t.faces.push([e[0],e[i],e[i+1]])}),t},i.prototype.computeHalfEdges=function(){var t=this.halfEdges=[],e=this.faces;e.forEach(function(e,i){e.halfEdges=[],e.forEach(function(n,r){var o=n,s=e[(r+1)%e.length],a={edgeIndex:t.length,face:e,faceIndex:i,slot:r,opposite:null,v0:Math.min(o,s),v1:Math.max(o,s)};e.halfEdges.push(a),t.push(a)})}),t.sort(function(t,e){return t.v0>e.v0?1:t.v0<e.v0?-1:t.v1>e.v1?1:t.v1<e.v1?-1:0});for(var i=1;i<t.length;i++){var n=t[i-1],r=t[i];n.v0==r.v0&&n.v1==r.v1&&(n.opposite=r,r.opposite=n)}return t},i.prototype.subdivideEdges=function(){var t=this.vertices,e=this.faces,a=this.computeHalfEdges(),h=t.map(function(t){return t}),u=[],c=[];a.forEach(function(e){if(!c[e.edgeIndex]){var i=n([t[e.face[e.slot]],t[s(e).face[s(e).slot]]]);c[e.edgeIndex]=i,c[e.opposite.edgeIndex]=i,h.push(i)}}),e.forEach(function(t){var e=[];r(t.halfEdges[0],function(t){e.push(h.indexOf(c[t.edgeIndex]))}),u.push(e)});var l=[];a.forEach(function(t){if(-1===l.indexOf(t.face[t.slot])){l.push(t.face[t.slot]);var e=[];o(t,function(t){e.push(h.indexOf(c[t.edgeIndex]))}),e.forEach(function(i,n){var r=e[(n+1)%e.length];u.push([t.face[t.slot],i,r])})}});var p=new i({vertices:h,faces:u});return p.computeEdges(),p},i.prototype.getFaceVertices=function(t){return t.map(function(t){return this.vertices[t]}.bind(this))},i.prototype.catmullClark=function(){var t=this.vertices,e=this.faces,a=this.computeHalfEdges(),h=e.map(this.getFaceVertices.bind(this)).map(n),u=[];a.forEach(function(e){if(!u[e.edgeIndex]){var i=n([t[e.v0],t[e.v1],h[e.faceIndex],h[e.opposite.faceIndex]]);u[e.edgeIndex]=i,u[e.opposite.edgeIndex]=i}});var l=[];a.map(function(i){var r=e[i.faceIndex][i.slot],s=t[r];if(!l[r]){var a=[],u=[];o(i,function(e){a.push(h[e.faceIndex]),u.push(n([t[e.v0],t[e.v1]]))});var p=n(a),f=n(u),d=a.length,g=new c(0,0,0);g.add(p),g.add(f.dup().scale(2)),g.add(s.dup().scale(d-3)),g.scale(1/d),l[r]=g}});var p=l.concat(h);a.forEach(function(t){t.added>-1||(t.added=p.length,t.opposite.added=p.length,p.push(u[t.edgeIndex]))});var f=[],d=[];return e.forEach(function(t,e){var i=e+l.length;r(t.halfEdges[0],function(e){var n=e.added,r=s(e),o=t[r.slot],a=r.added;d.push([i,n]),d.push([n,o]),f.push([i,n,o,a])})}),new i({vertices:p,faces:f,edges:d})},i.prototype.dooSabin=function(t){var e=this.vertices,c=this.faces,l=this.computeHalfEdges(),p=[],f=[],d=[];t=t||.1;var g=[];return c.forEach(function(i,o){var s=g[o]=[];return r(i.halfEdges[0],function(i){var r=e[i.face[i.slot]],o=n([r,n(h(e,i.face)),n(h(e,[i.v0,i.v1])),n(h(e,[a(i).v0,a(i).v1]))]);s.push(p.length),p.push(u(r,o,t))}),s}),c.forEach(function(t,e){f.push(g[e])}),l.forEach(function(t){if(!t.edgeVisited){t.edgeVisited=!0,t.opposite.edgeVisited=!0;var e=t,i=s(e.opposite),n=e.opposite,r=s(e),o=[g[e.faceIndex][e.slot],g[i.faceIndex][i.slot],g[n.faceIndex][n.slot],g[r.faceIndex][r.slot]];f.push(o),d.push([o[0],o[3]]),d.push([o[1],o[2]])}}),l.forEach(function(t){if(!t.vertexVisited){var e=[];o(t,function(t){t.vertexVisited=!0,e.push(g[t.faceIndex][t.slot])}),f.push(e),e.forEach(function(t,i){d.push([t,e[(i+1)%e.length]])})}}),new i({vertices:p,faces:f,edges:d})},i.prototype.wire=function(t,e){e=null!=e?e:t||.1,t=t||.1;var i=this.dooSabin(t);i.computeNormals();var n=(i.computeHalfEdges(),this.dooSabin(t));n.computeNormals(),n.vertices.forEach(function(t,i){t.sub(n.normals[i].dup().scale(e))});var o=i.faces.splice(0,this.faces.length);n.faces.splice(0,this.faces.length);var s=i.vertices.length;return n.vertices.forEach(function(t){i.vertices.push(t)}),n.faces.forEach(function(t){i.faces.push(t.map(function(t){return t+s}).reverse())}),n.edges.forEach(function(t){i.edges.push(t.map(function(t){return t+s}))}),o.forEach(function(t){r(t.halfEdges[0],function(t){var e=a(t);i.faces.push([e.face[e.slot],t.face[t.slot],t.face[t.slot]+s,e.face[e.slot]+s]),i.edges.push([e.face[e.slot],e.face[e.slot]+s]),i.edges.push([t.face[t.slot],t.face[t.slot]+s])})}),i},i.prototype.extrude=function(t,e,i){t=t||.1,i=i||0,e||(e=this.faces.map(function(t,e){return e}));var o=this.clone(),a=(o.computeHalfEdges(),new c),u=new c,l=new c,p=new c;return e.forEach(function(e){var c=o.faces[e],f=h(o.vertices,c),d=o.texCoords?h(o.texCoords,c):null,g=f[0],m=f[1],x=f[2];a.asSub(m,g).normalize(),u.asSub(x,g).normalize(),l.asCross(a,u).normalize(),l.scale(t);var v=f.map(function(t){return t.dup().add(l)}),y=[];if(v.forEach(function(t){y.push(o.vertices.length),o.vertices.push(t)}),d){var w=d.map(function(t){return t.dup()});w.forEach(function(t){o.texCoords.push(t)})}if(i){var x=n(v);v.forEach(function(t){p.asSub(x,t),p.scale(i),t.add(p)})}r(c.halfEdges[0],function(t){o.faces.push([c[t.slot],c[s(t).slot],y[s(t).slot],y[t.slot]])}),o.edges&&(y.forEach(function(t,e){o.edges.push([t,c[e]])}),y.forEach(function(t,e){o.edges.push([t,y[(e+1)%y.length]])})),y.forEach(function(t,e){c[e]=t})}),o},i.prototype.transform=function(t){for(var e=this.clone(),i=0;i<e.vertices.length;i++)e.vertices[i].transformMat4(t);return e.normals&&e.computeNormals(),e},e.exports=i},{"./BoundingBox":25,"./Ray":32,"./Vec3":40}],27:[function(t,e){function i(t,e,i,n,r,o,s,a,h,u,c,l,p,f,d,g){this.a11=t,this.a12=e,this.a13=i,this.a14=n,this.a21=r,this.a22=o,this.a23=s,this.a24=a,this.a31=h,this.a32=u,this.a33=c,this.a34=l,this.a41=p,this.a42=f,this.a43=d,this.a44=g,"undefined"==typeof this.a11&&this.reset()}var n=t("./Vec3");i.create=function(){return new i},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.a11-this.a11)<=e&&Math.abs(t.a12-this.a12)<=e&&Math.abs(t.a13-this.a13)<=e&&Math.abs(t.a14-this.a14)<=e&&Math.abs(t.a21-this.a21)<=e&&Math.abs(t.a22-this.a22)<=e&&Math.abs(t.a23-this.a23)<=e&&Math.abs(t.a24-this.a24)<=e&&Math.abs(t.a31-this.a31)<=e&&Math.abs(t.a32-this.a32)<=e&&Math.abs(t.a33-this.a33)<=e&&Math.abs(t.a34-this.a34)<=e&&Math.abs(t.a41-this.a41)<=e&&Math.abs(t.a42-this.a42)<=e&&Math.abs(t.a43-this.a43)<=e&&Math.abs(t.a44-this.a44)<=e},i.prototype.hash=function(){return.01*this.a11+.02*this.a12+.03*this.a13+.04*this.a14+.05*this.a21+.06*this.a22+.07*this.a23+.08*this.a24+.09*this.a31+.1*this.a32+.11*this.a33+.12*this.a34+.13*this.a41+.14*this.a42+.15*this.a43+.16*this.a44},i.prototype.set4x4r=function(t,e,i,n,r,o,s,a,h,u,c,l,p,f,d,g){return this.a11=t,this.a12=e,this.a13=i,this.a14=n,this.a21=r,this.a22=o,this.a23=s,this.a24=a,this.a31=h,this.a32=u,this.a33=c,this.a34=l,this.a41=p,this.a42=f,this.a43=d,this.a44=g,this},i.prototype.copy=function(t){return this.a11=t.a11,this.a12=t.a12,this.a13=t.a13,this.a14=t.a14,this.a21=t.a21,this.a22=t.a22,this.a23=t.a23,this.a24=t.a24,this.a31=t.a31,this.a32=t.a32,this.a33=t.a33,this.a34=t.a34,this.a41=t.a41,this.a42=t.a42,this.a43=t.a43,this.a44=t.a44,this},i.prototype.dup=function(){return i.create().copy(this)},i.prototype.reset=function(){return this.set4x4r(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},i.prototype.identity=function(){return this.reset(),this},i.prototype.mul4x4r=function(t,e,i,n,r,o,s,a,h,u,c,l,p,f,d,g){var m=this.a11,x=this.a12,v=this.a13,y=this.a14,w=this.a21,b=this.a22,E=this.a23,M=this.a24,T=this.a31,P=this.a32,C=this.a33,z=this.a34,A=this.a41,R=this.a42,_=this.a43,S=this.a44;return this.a11=m*t+x*r+v*h+y*p,this.a12=m*e+x*o+v*u+y*f,this.a13=m*i+x*s+v*c+y*d,this.a14=m*n+x*a+v*l+y*g,this.a21=w*t+b*r+E*h+M*p,this.a22=w*e+b*o+E*u+M*f,this.a23=w*i+b*s+E*c+M*d,this.a24=w*n+b*a+E*l+M*g,this.a31=T*t+P*r+C*h+z*p,this.a32=T*e+P*o+C*u+z*f,this.a33=T*i+P*s+C*c+z*d,this.a34=T*n+P*a+C*l+z*g,this.a41=A*t+R*r+_*h+S*p,this.a42=A*e+R*o+_*u+S*f,this.a43=A*i+R*s+_*c+S*d,this.a44=A*n+R*a+_*l+S*g,this},i.prototype.perspective=function(t,e,i,n){var r=1/Math.tan(t/180*Math.PI/2),o=1/(n-i);return this.mul4x4r(r/e,0,0,0,0,r,0,0,0,0,-(n+i)*o,-2*n*i*o,0,0,-1,0),this},i.prototype.ortho=function(t,e,i,n,r,o){return this.mul4x4r(2/(e-t),0,0,(e+t)/(t-e),0,2/(n-i),0,(n+i)/(i-n),0,0,2/(r-o),(o+r)/(r-o),0,0,0,1),this},i.prototype.lookAt=function(t,e,i){var r=n.create(t.x-e.x,t.y-e.y,t.z-e.z).normalize(),o=n.create(i.x,i.y,i.z).cross(r).normalize(),s=n.create().copy(r).cross(o).normalize();return this.mul4x4r(o.x,o.y,o.z,0,s.x,s.y,s.z,0,r.x,r.y,r.z,0,0,0,0,1),this.translate(-t.x,-t.y,-t.z),this},i.prototype.translate=function(t,e,i){return this.mul4x4r(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this},i.prototype.rotate=function(t,e,i,n){var r=Math.sin(t),o=Math.cos(t);return this.mul4x4r(e*e*(1-o)+o,e*i*(1-o)-n*r,e*n*(1-o)+i*r,0,i*e*(1-o)+n*r,i*i*(1-o)+o,i*n*(1-o)-e*r,0,e*n*(1-o)-i*r,i*n*(1-o)+e*r,n*n*(1-o)+o,0,0,0,0,1),this},i.prototype.asMul=function(t,e){var i=t.a11,n=t.a12,r=t.a13,o=t.a14,s=t.a21,a=t.a22,h=t.a23,u=t.a24,c=t.a31,l=t.a32,p=t.a33,f=t.a34,d=t.a41,g=t.a42,m=t.a43,x=t.a44,v=e.a11,y=e.a12,w=e.a13,b=e.a14,E=e.a21,M=e.a22,T=e.a23,P=e.a24,C=e.a31,z=e.a32,A=e.a33,R=e.a34,_=e.a41,S=e.a42,L=e.a43,N=e.a44;return this.a11=i*v+n*E+r*C+o*_,this.a12=i*y+n*M+r*z+o*S,this.a13=i*w+n*T+r*A+o*L,this.a14=i*b+n*P+r*R+o*N,this.a21=s*v+a*E+h*C+u*_,this.a22=s*y+a*M+h*z+u*S,this.a23=s*w+a*T+h*A+u*L,this.a24=s*b+a*P+h*R+u*N,this.a31=c*v+l*E+p*C+f*_,this.a32=c*y+l*M+p*z+f*S,this.a33=c*w+l*T+p*A+f*L,this.a34=c*b+l*P+p*R+f*N,this.a41=d*v+g*E+m*C+x*_,this.a42=d*y+g*M+m*z+x*S,this.a43=d*w+g*T+m*A+x*L,this.a44=d*b+g*P+m*R+x*N,this},i.prototype.mul=function(t){return this.asMul(this,t)},i.prototype.scale=function(t,e,i){return this.mul4x4r(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this},i.prototype.invert=function(){var t=this.a11,e=this.a12,i=this.a13,n=this.a14,r=this.a21,o=this.a22,s=this.a23,a=this.a24,h=this.a31,u=this.a32,c=this.a33,l=this.a34,p=this.a41,f=this.a42,d=this.a43,g=this.a44,m=t*o-e*r,x=t*s-i*r,v=t*a-n*r,y=e*s-i*o,w=e*a-n*o,b=i*a-n*s,E=h*f-u*p,M=h*d-c*p,T=h*g-l*p,P=u*d-c*f,C=u*g-l*f,z=c*g-l*d,A=1/(m*z-x*C+v*P+y*T-w*M+b*E);return this.a11=(+o*z-s*C+a*P)*A,this.a12=(-e*z+i*C-n*P)*A,this.a13=(+f*b-d*w+g*y)*A,this.a14=(-u*b+c*w-l*y)*A,this.a21=(-r*z+s*T-a*M)*A,this.a22=(+t*z-i*T+n*M)*A,this.a23=(-p*b+d*v-g*x)*A,this.a24=(+h*b-c*v+l*x)*A,this.a31=(+r*C-o*T+a*E)*A,this.a32=(-t*C+e*T-n*E)*A,this.a33=(+p*w-f*v+g*m)*A,this.a34=(-h*w+u*v-l*m)*A,this.a41=(-r*P+o*M-s*E)*A,this.a42=(+t*P-e*M+i*E)*A,this.a43=(-p*y+f*x-d*m)*A,this.a44=(+h*y-u*x+c*m)*A,this},i.prototype.transpose=function(){var t=this.a11,e=this.a12,i=this.a13,n=this.a14,r=this.a21,o=this.a22,s=this.a23,a=this.a24,h=this.a31,u=this.a32,c=this.a33,l=this.a34,p=this.a41,f=this.a42,d=this.a43,g=this.a44;return this.a11=t,this.a12=r,this.a13=h,this.a14=p,this.a21=e,this.a22=o,this.a23=u,this.a24=f,this.a31=i,this.a32=s,this.a33=c,this.a34=d,this.a41=n,this.a42=a,this.a43=l,this.a44=g,this},i.prototype.toArray=function(){return[this.a11,this.a21,this.a31,this.a41,this.a12,this.a22,this.a32,this.a42,this.a13,this.a23,this.a33,this.a43,this.a14,this.a24,this.a34,this.a44]},i.prototype.fromArray=function(t){return this.a11=t[0](this.a21=t[1](this.a31=t[2](this.a41=t[3]))),this.a12=t[4](this.a22=t[5](this.a32=t[6](this.a42=t[7]))),this.a13=t[8](this.a23=t[9](this.a33=t[10](this.a43=t[11]))),this.a14=t[12](this.a24=t[13](this.a34=t[14](this.a44=t[15]))),this},e.exports=i},{"./Vec3":40}],28:[function(t,e){function i(t,e){this.maxDistance=Math.max(e.x,Math.max(e.y,e.z)),this.accuracy=0,this.root=new i.Cell(this,t,e,0)}var n=t("pex-geom"),r=n.Vec3;i.fromBoundingBox=function(t){return new i(t.min.clone(),t.getSize().clone())},i.MaxLevel=8,i.prototype.add=function(t,e){this.root.add(t,e)},i.prototype.has=function(t){return this.root.has(t)},i.prototype.findNearestPoint=function(t,e){e.includeData=e.includeData?e.includeData:!1,e.bestDist=e.maxDist?e.maxDist:1/0,e.notSelf=e.notSelf?e.notSelf:!1;var i=this.root.findNearestPoint(t,e);return i?e.includeData?i:i.point:null},i.prototype.findNearbyPoints=function(t,e,i){i=i||{};var n={points:[],data:[]};return this.root.findNearbyPoints(t,e,n,i),n},i.prototype.getAllCellsAtLevel=function(t,e,i){return"undefined"==typeof e&&(e=t,t=this.root),i=i||[],t.level==e?(t.points.length>0&&i.push(t),i):(t.children.forEach(function(t){this.getAllCellsAtLevel(t,e,i)}.bind(this)),i)},i.Cell=function(t,e,i,n){this.tree=t,this.position=e,this.size=i,this.level=n,this.points=[],this.data=[],this.temp=new r,this.children=[]},i.Cell.prototype.has=function(t){if(!this.contains(t))return null;if(this.children.length>0){for(var e=0;e<this.children.length;e++){var i=this.children[e].has(t);if(i)return i}return null}for(var n=this.tree.accuracy*this.tree.accuracy,e=0;e<this.points.length;e++){var r=this.points[e],o=t.squareDistance(r);if(n>=o)return r}return null},i.Cell.prototype.add=function(t,e){this.points.push(t),this.data.push(e),this.children.length>0?this.addToChildren(t,e):this.points.length>1&&this.level<i.MaxLevel&&this.split()},i.Cell.prototype.addToChildren=function(t,e){for(var i=0;i<this.children.length;i++)if(this.children[i].contains(t)){this.children[i].add(t,e);break}},i.Cell.prototype.contains=function(t){return t.x>=this.position.x-this.tree.accuracy&&t.y>=this.position.y-this.tree.accuracy&&t.z>=this.position.z-this.tree.accuracy&&t.x<this.position.x+this.size.x+this.tree.accuracy&&t.y<this.position.y+this.size.y+this.tree.accuracy&&t.z<this.position.z+this.size.z+this.tree.accuracy},i.Cell.prototype.split=function(){var t=this.position.x,e=this.position.y,n=this.position.z,o=this.size.x/2,s=this.size.y/2,a=this.size.z/2;this.children.push(new i.Cell(this.tree,r.create(t,e,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e+s,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e+s,n),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t,e+s,n+a),r.create(o,s,a),this.level+1)),this.children.push(new i.Cell(this.tree,r.create(t+o,e+s,n+a),r.create(o,s,a),this.level+1));for(var h=0;h<this.points.length;h++)this.addToChildren(this.points[h],this.data[h])},i.Cell.prototype.squareDistanceToCenter=function(t){var e=t.x-(this.position.x+this.size.x/2),i=t.y-(this.position.y+this.size.y/2),n=t.z-(this.position.z+this.size.z/2);return e*e+i*i+n*n},i.Cell.prototype.findNearestPoint=function(t,e){var i=null,n=null,r=e.bestDist;if(this.points.length>0&&0==this.children.length)for(var o=0;o<this.points.length;o++){var s=this.points[o].distance(t);if(r>=s){if(0==s&&e.notSelf)continue;r=s,i=this.points[o],n=this.data[o]}}var a=this.children,a=this.children.map(function(e){return{child:e,dist:e.squareDistanceToCenter(t)}}).sort(function(t,e){return t.dist-e.dist}).map(function(t){return t.child});if(a.length>0)for(var o=0;o<a.length;o++){var h=a[o];if(h.points.length>0){if(t.x<h.position.x-r||t.x>h.position.x+h.size.x+r||t.y<h.position.y-r||t.y>h.position.y+h.size.y+r||t.z<h.position.z-r||t.z>h.position.z+h.size.z+r)continue;var u=h.findNearestPoint(t,e);if(!u||!u.point)continue;var c=u.point.distance(t);
r>c&&(i=u.point,r=c,n=u.data)}}return{point:i,data:n}},i.Cell.prototype.findNearbyPoints=function(t,e,i,n){if(this.points.length>0&&0==this.children.length)for(var r=0;r<this.points.length;r++){var o=this.points[r].distance(t);if(e>=o){if(0==o&&n.notSelf)continue;i.points.push(this.points[r]),n.includeData&&i.data.push(this.data[r])}}var s=this.children;if(s.length>0)for(var r=0;r<s.length;r++){var a=s[r];if(a.points.length>0){if(t.x<a.position.x-e||t.x>a.position.x+a.size.x+e||t.y<a.position.y-e||t.y>a.position.y+a.size.y+e||t.z<a.position.z-e||t.z>a.position.z+a.size.z+e)continue;a.findNearbyPoints(t,e,i,n)}}},e.exports=i},{"pex-geom":24}],29:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=1e3}var n=t("./Vec3");i.prototype.addPoint=function(t){return this.points.push(t)},i.prototype.getPoint=function(t){var e=t*(this.points.length-1),i=Math.floor(e),r=e-i,o=i,s=i+1;i===this.points.length-1&&(o=i,s=i);var a=new n;return a.x=this.points[o].x+(this.points[s].x-this.points[o].x)*r,a.y=this.points[o].y+(this.points[s].y-this.points[o].y)*r,a.z=this.points[o].z+(this.points[s].z-this.points[o].z)*r,a},i.prototype.getPointAt=function(t){this.closed||(t=Math.max(0,Math.min(t,1))),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e,!0)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.close=function(){return this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.reverse=function(){return this.points=this.points.reverse(),this.dirtyLength=!0},i.prototype.precalculateLength=function(){this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var t=1/this.samplesCount,e=0,i=0,n=null,r=null,o=0;o<this.samplesCount;o++)r=n,n=this.getPoint(e),o>0&&(i+=n.dup().sub(r).length()),this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t;for(var o=0;o<this.accumulatedLengths.length-1;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);return this.length=i,this.dirtyLength=!1},e.exports=i},{"./Vec3":40}],30:[function(t,e){function i(t,e){this.point=t,this.normal=e,this.u=new r,this.v=new r,this.updateUV()}var n=t("./Vec2"),r=t("./Vec3");i.prototype.set=function(t,e){this.point=t,this.normal=e,this.updateUV()},i.prototype.setPoint=function(t){this.point=t,this.updateUV()},i.prototype.setNormal=function(t){this.normal=t,this.updateUV()},i.prototype.project=function(t){var e=r.create().asSub(t,this.point),i=e.dot(this.normal),n=this.normal.clone().scale(i),o=t.clone().sub(n);return o},i.prototype.intersectRay=function(t){return t.hitTestPlane(this.point,this.normal)[0]},i.prototype.rebase=function(t){var e=t.dup().sub(this.point),i=this.u.dot(e),r=this.v.dot(e);return new n(i,r)},i.prototype.updateUV=function(){if(Math.abs(this.normal.x)>Math.abs(this.normal.y)){var t=1/Math.sqrt(this.normal.x*this.normal.x+this.normal.z*this.normal.z);this.u.set(this.normal.x*t,0,-this.normal.z*t)}else{var t=1/Math.sqrt(this.normal.y*this.normal.y+this.normal.z*this.normal.z);this.u.set(0,this.normal.z*t,-this.normal.y*t)}this.v.setVec3(this.normal).cross(this.u)},e.exports=i},{"./Vec2":39,"./Vec3":40}],31:[function(t,e){function i(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:1}var n=t("./Mat4"),r=t("./Vec3"),o=Math.pow(2,-24);i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.prototype.identity=function(){return this.set(0,0,0,1),this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e&&Math.abs(t.w-this.w)<=e},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)},i.prototype.dup=function(){return this.clone()},i.prototype.setAxisAngle=function(t,e){e=.5*e;var i=Math.sin(e/180*Math.PI);return this.x=i*t.x,this.y=i*t.y,this.z=i*t.z,this.w=Math.cos(e/180*Math.PI),this},i.prototype.setQuat=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.asMul=function(t,e){var i=t.x,n=t.y,r=t.z,o=t.w,s=e.x,a=e.y,h=e.z,u=e.w;return this.x=i*u+o*s+n*h-r*a,this.y=n*u+o*a+r*s-i*h,this.z=r*u+o*h+i*a-n*s,this.w=o*u-i*s-n*a-r*h,this},i.prototype.mul=function(t){return this.asMul(this,t),this},i.prototype.mul4=function(t,e,i,n){var r=this.x,o=this.y,s=this.z,a=this.w;return this.x=n*r+t*a+e*s-i*o,this.y=n*o+e*a+i*r-t*s,this.z=n*s+i*a+t*o-e*r,this.w=n*a-t*r-e*o-i*s,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},i.prototype.normalize=function(){var t=this.length();return t>o&&(this.x/=t,this.y/=t,this.z/=t,this.w/=t),this},i.prototype.toMat4=function(t){var e=this.x+this.x,i=this.y+this.y,r=this.z+this.z,o=this.w*e,s=this.w*i,a=this.w*r,h=this.x*e,u=this.x*i,c=this.x*r,l=this.y*i,p=this.y*r,f=this.z*r,d=t||new n;return d.set4x4r(1-(l+f),u-a,c+s,0,u+a,1-(h+f),p-o,0,c-s,p+o,1-(h+l),0,0,0,0,1)},i.prototype.setDirection=function(t,e){var o=r.create().copy(t).normalize(),s=r.create(0,1,0),a=r.create().asCross(s,o);0==a.length()&&(s.set(1,0,0),a.asCross(s,o)),s.asCross(o,a),a.normalize(),s.normalize(),e&&console.log("dir",o),e&&console.log("up",s),e&&console.log("right",a);var h=new n;h.set4x4r(a.x,a.y,a.z,0,s.x,s.y,s.z,0,o.x,o.y,o.z,0,0,0,0,1);var u=new i;if(1+h.a11+h.a22+h.a33<.001){e&&console.log("singularity"),o=t.dup(),o.z*=-1,o.normalize(),s.set(0,1,0),a.asCross(s,o),s.asCross(o,a),a.normalize(),s.normalize(),h=new n,h.set4x4r(a.x,a.y,a.z,0,s.x,s.y,s.z,0,o.x,o.y,o.z,0,0,0,0,1),u.w=Math.sqrt(1+h.a11+h.a22+h.a33)/2;var c=4*u.w;return u.x=(h.a23-h.a32)/c,u.y=(h.a31-h.a13)/c,u.z=(h.a12-h.a21)/c,e&&console.log("dir",o),e&&console.log("up",s),e&&console.log("right",a),q2=new i,q2.setAxisAngle(new r(0,1,0),180),q2.mul(u),this.copy(q2),this}return u.w=Math.sqrt(1+h.a11+h.a22+h.a33)/2,c=4*u.w,u.x=(h.a23-h.a32)/c,u.y=(h.a31-h.a13)/c,u.z=(h.a12-h.a21)/c,this.copy(u),this},i.prototype.slerp=function(t,e){var i=this,n=i.w*t.w+i.x*t.x+i.y*t.y+i.z*t.z;if(Math.abs(n)>=1)return this;var r=Math.acos(n),o=Math.sqrt(1-n*n);if(Math.abs(o)<.001)return this.w=.5*i.w+.5*t.w,this.x=.5*i.x+.5*t.x,this.y=.5*i.y+.5*t.y,this.z=.5*i.z+.5*t.z,this;var s=Math.sin((1-e)*r)/o,a=Math.sin(e*r)/o;return this.w=i.w*s+t.w*a,this.x=i.x*s+t.x*a,this.y=i.y*s+t.y*a,this.z=i.z*s+t.z*a,this},i.fromAxisAngle=function(t,e){return(new i).setAxisAngle(t,e)},i.fromDirection=function(t){return(new i).setDirection(t)},e.exports=i},{"./Mat4":27,"./Vec3":40}],32:[function(t,e){function i(t,e){this.origin=t||new n(0,0,0),this.direction=e||new n(0,0,1)}var n=t("./Vec3"),r=1e-4;i.prototype.hitTestSphere=function(t,e){var i=[],n=this.direction,r=this.origin,o=r.dup().sub(t),s=n.dot(n);if(0==s)return i;var a=2*o.dot(n),h=o.dot(o)-e*e,u=Math.sqrt(a*a-4*s*h);if(isNaN(u))return i;var c=(-a-u)/(2*s),l=(-a+u)/(2*s);return i.push(r.dup().add(n.dup().scale(c))),c!=l&&i.push(r.dup().add(n.dup().scale(l))),i},i.prototype.hitTestPlane=function(t,e){if(0==this.direction.dot(e))return[];var i=e.dup().scale(-1).dot(this.origin.dup().sub(t))/this.direction.dot(e);return[this.origin.dup().add(this.direction.dup().scale(i))]},i.prototype.hitTestBoundingBox=function(t){function e(t,e,n,o,s){var a=r.hitTestPlane(t,n);if(a.length>0){var h=a[0];h[o]>t[o]-e[o]/2&&h[o]<t[o]+e[o]/2&&h[s]>t[s]-e[s]/2&&h[s]<t[s]+e[s]/2&&i.push(h)}}var i=[],r=this,o=t.getCenter(),s=t.getSize();return e(o.dup().add(new n(0,0,s.z/2)),s,new n(0,0,1),"x","y"),e(o.dup().add(new n(0,0,-s.z/2)),s,new n(0,0,-1),"x","y"),e(o.dup().add(new n(s.x/2,0,0)),s,new n(1,0,0),"y","z"),e(o.dup().add(new n(-s.x/2,0,0)),s,new n(-1,0,0),"y","z"),e(o.dup().add(new n(0,s.y/2,0)),s,new n(0,1,0),"x","z"),e(o.dup().add(new n(0,-s.y/2,0)),s,new n(0,-1,0),"x","z"),i.forEach(function(t){t._distance=t.distance(r.origin)}),i.sort(function(t,e){return t._distance-e._distance}),i.forEach(function(t){delete t._distance}),i.length>0&&(i=[i[0]]),i},i.prototype.hitTestTriangle=function(t){var e=this,i=t.b.dup().sub(t.a),o=t.c.dup().sub(t.a),s=n.create().asCross(i,o);if(s.length()<r)return-1;var a=e.origin.dup().sub(t.a),h=-s.dot(a),u=s.dot(e.direction);if(Math.abs(u)<r)return 0==h?-2:-3;var c=h/u;if(-r>c)return-4;var l=e.origin.dup().add(e.direction.dup().scale(c)),p=i.dot(i),f=i.dot(o),d=o.dot(o),g=l.dup().sub(t.a),m=g.dot(i),x=g.dot(o),v=f*f-p*d,y=(f*x-d*m)/v;if(-r>y||y>1+r)return-5;var w=(f*m-p*x)/v;return-r>w||y+w>1+r?-6:i.scale(y).add(o.scale(w)).add(t.a)},e.exports=i},{"./Vec3":40}],33:[function(t,e){function i(t,e){if(0==arguments.length)this.min=new r(1/0,1/0),this.max=new r(-1/0,-1/0);else if(2==arguments.length)this.min=t,this.max=e;else if(4==arguments.length){var i=arguments[0],n=arguments[1],o=arguments[2],s=arguments[3];this.min=new r(i,n),this.max=new r(i+o,n+s)}Object.defineProperty(this,"x",{set:function(t){var e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e},get:function(){return this.min.x}}),Object.defineProperty(this,"y",{set:function(t){var e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e},get:function(){return this.min.y}}),Object.defineProperty(this,"width",{set:function(t){this.max.x=this.min.x+t},get:function(){return this.max.x-this.min.x}}),Object.defineProperty(this,"height",{set:function(t){this.max.y=this.min.y+t},get:function(){return this.max.y-this.min.y}})}var n=t("pex-geom"),r=n.Vec2;i.prototype.set=function(t,e,i,n){this.min.x=t,this.min.y=e,this.max.x=t+i,this.max.y=e+n},i.prototype.contains=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y},i.prototype.getCenter=function(t){return t=t||new r,t.asAdd(this.min,this.max).scale(.5),t},i.prototype.getSize=function(t){return t=t||new r,t.asSub(this.max,this.min),t},i.fromPoints=function(t){for(var e=new i,n=e.min,r=e.max,o=0;o<t.length;o++){var s=t[o];n.x=Math.min(n.x,s.x),n.y=Math.min(n.y,s.y),r.x=Math.max(r.x,s.x),r.y=Math.max(r.y,s.y)}return e},e.exports=i},{"pex-geom":24}],34:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=2e3}i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,n,r,o=this.points,s=this.closed?o.length:o.length-1,a=t*s,h=Math.floor(a),u=a-h;return this.closed?(e=(h-1+o.length)%o.length,i=h%o.length,n=(h+1)%o.length,r=(h+2)%o.length):(e=0==h?h:h-1,i=h,n=h>o.length-2?h:h+1,r=h>o.length-3?h:h+2),this.interpolate(o[e],o[i],o[n],o[r],u)},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[];for(var n,r,e=0,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=Math.sqrt(1+(n-r)*(n-r));i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{}],35:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=100}var n=t("./Vec2");i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,r,o,s=this.points,a=this.closed?s.length:s.length-1,h=t*a,u=Math.floor(h),c=h-u;this.closed?(e=(u-1+s.length)%s.length,i=u%s.length,r=(u+1)%s.length,o=(u+2)%s.length):(e=0==u?u:u-1,i=u,r=u>s.length-2?u:u+1,o=u>s.length-3?u:u+2);var l=new n;return l.x=this.interpolate(s[e].x,s[i].x,s[r].x,s[o].x,c),l.y=this.interpolate(s[e].y,s[i].y,s[r].y,s[o].y,c),l},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var n,r,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=n.dup().sub(r).length();i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{"./Vec2":39}],36:[function(t,e){function i(t,e){this.points=t||[],this.dirtyLength=!0,this.closed=e||!1,this.samplesCount=1e3}var n=t("./Vec3");i.prototype.getPoint=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1));var e,i,r,o,s=this.points,a=this.closed?s.length:s.length-1,h=t*a,u=Math.floor(h),c=h-u;this.closed?(e=(u-1+s.length)%s.length,i=u%s.length,r=(u+1)%s.length,o=(u+2)%s.length):(e=0==u?u:u-1,i=u,r=u>s.length-2?u:u+1,o=u>s.length-3?u:u+2);var l=new n;return l.x=this.interpolate(s[e].x,s[i].x,s[r].x,s[o].x,c),l.y=this.interpolate(s[e].y,s[i].y,s[r].y,s[o].y,c),l.z=this.interpolate(s[e].z,s[i].z,s[r].z,s[o].z,c),l},i.prototype.addPoint=function(t){this.dirtyLength=!0,this.points.push(t)},i.prototype.getPointAt=function(t){t=this.closed?(t+1)%1:Math.max(0,Math.min(t,1)),this.dirtyLength&&this.precalculateLength();for(var e=0,i=0;i<this.accumulatedLengthRatios.length;i++)if(this.accumulatedLengthRatios[i]>t-1/this.samplesCount){e=this.accumulatedRatios[i];break}return this.getPoint(e)},i.prototype.getClosestPoint=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i){var n=t.squareDistance(i);return n<e.dist?{dist:n,point:i}:e},{dist:1/0,point:null});return e.point},i.prototype.getClosestPointRatio=function(t){this.dirtyLength&&this.precalculateLength();var e=this.precalculatedPoints.reduce(function(e,i,n){var r=t.squareDistance(i);return r<e.dist?{dist:r,point:i,index:n}:e},{dist:1/0,point:null,index:-1});return this.accumulatedLengthRatios[e.index]},i.prototype.getTangentAt=function(t){var e=.99>t?t:t-.01,i=.99>t?t+.01:t,r=this.getPointAt(e),o=this.getPointAt(i);return n.create().asSub(o,r).normalize()},i.prototype.getPointAtIndex=function(t){return t<this.points.length?this.points[t]:null},i.prototype.getNumPoints=function(){return this.points.length},i.prototype.getLength=function(){return this.dirtyLength&&this.precalculateLength(),this.length},i.prototype.precalculateLength=function(){var t=1/this.samplesCount,e=0,i=0;this.accumulatedRatios=[],this.accumulatedLengthRatios=[],this.accumulatedLengths=[],this.precalculatedPoints=[];for(var n,r,o=0;o<this.samplesCount;o++){if(r=n,n=this.getPoint(e),o>0){var s=n.dup().sub(r).length();i+=s}this.accumulatedRatios.push(e),this.accumulatedLengths.push(i),this.precalculatedPoints.push(n),e+=t}for(var o=0;o<this.samplesCount;o++)this.accumulatedLengthRatios.push(this.accumulatedLengths[o]/i);this.length=i,this.dirtyLength=!1},i.prototype.close=function(){this.closed=!0},i.prototype.isClosed=function(){return this.closed},i.prototype.interpolate=function(t,e,i,n,r){var o=.5*(i-t),s=.5*(n-e),a=r*r,h=r*a;return(2*e-2*i+o+s)*h+(-3*e+3*i-2*o-s)*a+o*r+e},e.exports=i},{"./Vec3":40}],37:[function(t,e){function i(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)}function n(t,e,i){this.a=t,this.b=e,this.c=i}n.prototype.contains=function(t){var e=i(this.a,this.b,t)<0,n=i(this.b,this.c,t)<0,r=i(this.c,this.a,t)<0;return e==n&&n==r},n.prototype.getArea=function(){var t=this.a.distance(this.b),e=this.a.distance(this.c),i=this.b.distance(this.c),n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))},e.exports=n},{}],38:[function(t,e){function i(t,e,i){this.a=t,this.b=e,this.c=i}i.prototype.getArea=function(){var t=this.a.distance(this.b),e=this.a.distance(this.c),i=this.b.distance(this.c),n=(t+e+i)/2;return Math.sqrt(n*(n-t)*(n-e)*(n-i))},e.exports=i},{}],39:[function(t,e){function i(t,e){this.x=null!=t?t:0,this.y=null!=e?e:0}i.create=function(t,e){return new i(t,e)},i.fromArray=function(t){return new i(t[0],t[1])},i.fromDirection=function(t,e){return(new i).setDirection(t,e)},i.prototype.set=function(t,e){return this.x=t,this.y=e,this},i.prototype.setVec2=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.setDirection=function(t,e){return e=e||1,this.x=e*Math.cos(t/360*Math.PI*2),this.y=e*Math.sin(t/360*Math.PI*2),this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this},i.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},i.prototype.squareDistance=function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},i.prototype.simpleDistance=function(t){var e=Math.abs(t.x-this.x),i=Math.abs(t.y-this.y);return Math.min(e,i)},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.dup=function(){return this.clone()},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y},i.prototype.asAdd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},i.prototype.asSub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},i.prototype.addScaled=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},i.prototype.direction=function(){var t=Math.atan2(this.y,this.x),e=180*t/Math.PI;return 0>e&&(e=360+e),e},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},i.prototype.normalize=function(){var t=this.length();return t>0&&this.scale(1/t),this},i.prototype.limit=function(t){var e=this.length();return e>t&&e>0&&this.scale(t/e),this},i.prototype.lerp=function(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+"}"},i.prototype.hash=function(){return 1*this.x+12*this.y},e.exports=i},{}],40:[function(t,e){function i(t,e,i){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0}i.create=function(t,e,n){return new i(t,e,n)},i.fromArray=function(t){return new i(t[0],t[1],t[2])},i.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},i.prototype.setVec3=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.equals=function(t,e){return void 0==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.distance=function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return Math.sqrt(e*e+i*i+n*n)},i.prototype.squareDistance=function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return e*e+i*i+n*n},i.prototype.simpleDistance=function(t){var e=Math.abs(t.x-this.x),i=Math.abs(t.y-this.y),n=Math.abs(t.z-this.z);return Math.min(e,i,n)},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.clone=function(){return new i(this.x,this.y,this.z)},i.prototype.dup=function(){return this.clone()},i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.cross=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z;return this.x=i*s-n*o,this.y=n*r-e*s,this.z=e*o-i*r,this},i.prototype.asAdd=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},i.prototype.asSub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},i.prototype.asCross=function(t,e){return this.copy(t).cross(e)},i.prototype.addScaled=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},i.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},i.prototype.normalize=function(){var t=this.length();return t>0&&this.scale(1/t),this},i.prototype.limit=function(t){var e=this.length();return e>t&&e>0&&this.scale(t/e),this},i.prototype.lerp=function(t,e){return this.x=this.x+(t.x-this.x)*e,this.y=this.y+(t.y-this.y)*e,this.z=this.z+(t.z-this.z)*e,this},i.prototype.transformMat4=function(t){var e=t.a14+t.a11*this.x+t.a12*this.y+t.a13*this.z,i=t.a24+t.a21*this.x+t.a22*this.y+t.a23*this.z,n=t.a34+t.a31*this.x+t.a32*this.y+t.a33*this.z;return this.x=e,this.y=i,this.z=n,this},i.prototype.transformQuat=function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,s=t.z,a=t.w,h=a*e+o*n-s*i,u=a*i+s*e-r*n,c=a*n+r*i-o*e,l=-r*e-o*i-s*n;return this.x=h*a+l*-r+u*-s-c*-o,this.y=u*a+l*-o+c*-r-h*-s,this.z=c*a+l*-s+h*-o-u*-r,this},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+"}"},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z},i.Zero=new i(0,0,0),e.exports=i},{}],41:[function(t,e){function i(t,e,i,n){this.x=null!=t?t:0,this.y=null!=e?e:0,this.z=null!=i?i:0,this.w=null!=n?n:0}i.create=function(t,e,n,r){return new i(t,e,n,r)},i.fromArray=function(t){return new i(t[0],t[1],t[2],t[3])},i.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},i.prototype.setVec4=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.equals=function(t,e){return null==e&&(e=1e-7),Math.abs(t.x-this.x)<=e&&Math.abs(t.y-this.y)<=e&&Math.abs(t.z-this.z)<=e&&Math.abs(t.w-this.w)<=e},i.prototype.transformMat4=function(t){var e=t.a14*this.w+t.a11*this.x+t.a12*this.y+t.a13*this.z,i=t.a24*this.w+t.a21*this.x+t.a22*this.y+t.a23*this.z,n=t.a34*this.w+t.a31*this.x+t.a32*this.y+t.a33*this.z,r=t.a44*this.w+t.a41*this.x+t.a42*this.y+t.a43*this.z;return this.x=e,this.y=i,this.z=n,this.w=r,this},i.prototype.toString=function(){return"{"+Math.floor(1e3*this.x)/1e3+", "+Math.floor(1e3*this.y)/1e3+", "+Math.floor(1e3*this.z)/1e3+", "+Math.floor(1e3*this.w)/1e3+"}"},i.prototype.hash=function(){return 1*this.x+12*this.y+123*this.z+1234*this.w},e.exports=i},{}],42:[function(t,e){e.exports.Context=t("./lib/Context"),e.exports.Texture=t("./lib/Texture"),e.exports.Texture2D=t("./lib/Texture2D"),e.exports.TextureCube=t("./lib/TextureCube"),e.exports.Program=t("./lib/Program"),e.exports.Material=t("./lib/Material"),e.exports.Mesh=t("./lib/Mesh"),e.exports.OrthographicCamera=t("./lib/OrthographicCamera"),e.exports.PerspectiveCamera=t("./lib/PerspectiveCamera"),e.exports.Arcball=t("./lib/Arcball"),e.exports.ScreenImage=t("./lib/ScreenImage"),e.exports.RenderTarget=t("./lib/RenderTarget");var i=t("./lib/Utils");for(var n in i)e.exports[n]=i[n]},{"./lib/Arcball":43,"./lib/Context":45,"./lib/Material":46,"./lib/Mesh":47,"./lib/OrthographicCamera":48,"./lib/PerspectiveCamera":49,"./lib/Program":50,"./lib/RenderTarget":51,"./lib/ScreenImage":53,"./lib/Texture":54,"./lib/Texture2D":55,"./lib/TextureCube":56,"./lib/Utils":57}],43:[function(t,e){var i,n,r,o,s,a,h,u;u=t("pex-geom"),s=u.Vec2,a=u.Vec3,h=u.Vec4,o=u.Quat,n=u.Mat4,r=u.Plane,i=function(){function t(t,e,i){this.camera=e,this.window=t,this.radius=2*Math.min(t.width/2,t.height/2),this.center=s.create(t.width/2,t.height/2),this.currRot=o.create(),this.currRot.setAxisAngle(a.create(0,1,0),0),this.clickRot=o.create(),this.dragRot=o.create(),this.clickPos=a.create(),this.clickPosWindow=s.create(),this.dragPos=a.create(),this.dragPosWindow=s.create(),this.rotAxis=a.create(),this.allowZooming=!0,this.enabled=!0,this.clickTarget=a.create(0,0,0),this.setDistance(i||2),this.updateCamera(),this.addEventHanlders()}return t.prototype.setTarget=function(t){return this.camera.setTarget(t),this.updateCamera()},t.prototype.setOrientation=function(t){return this.currRot.setDirection(t),this.currRot.w*=-1,this.updateCamera(),this},t.prototype.setPosition=function(t){var e;return e=a.create().asSub(t,this.camera.getTarget()),this.setOrientation(e.dup().normalize()),this.setDistance(e.length()),this.updateCamera()},t.prototype.addEventHanlders=function(){return this.window.on("leftMouseDown",function(t){return function(e){return!e.handled&&t.enabled?t.down(e.x,e.y,e.shift):void 0}}(this)),this.window.on("leftMouseUp",function(t){return function(e){return t.up(e.x,e.y,e.shift)}}(this)),this.window.on("mouseDragged",function(t){return function(e){return!e.handled&&t.enabled?t.drag(e.x,e.y,e.shift):void 0}}(this)),this.window.on("scrollWheel",function(t){return function(e){return!e.handled&&t.enabled&&t.allowZooming?(t.distance=Math.min(t.maxDistance,Math.max(t.distance+e.dy/100*(t.maxDistance-t.minDistance),t.minDistance)),t.updateCamera()):void 0}}(this))},t.prototype.mouseToSphere=function(t,e){var i,n;return e=this.window.height-e,n=a.create((t-this.center.x)/this.radius,(e-this.center.y)/this.radius,0),i=n.x*n.x+n.y*n.y,i>1?n.normalize():n.z=Math.sqrt(1-i),n},t.prototype.down=function(t,e,i){var n,o;return this.dragging=!0,this.clickPos=this.mouseToSphere(t,e),this.clickRot.copy(this.currRot),this.updateCamera(),i?(this.clickPosWindow.set(t,e),n=this.camera.getTarget(),this.clickTarget=n.dup(),o=n.dup().transformMat4(this.camera.getViewMatrix()),this.panPlane=new r(o,new a(0,0,1)),this.clickPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.clickPosWindow.x,this.clickPosWindow.y,this.window.width,this.window.height)),this.dragPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.dragPosWindow.x,this.dragPosWindow.y,this.window.width,this.window.height))):this.panPlane=null},t.prototype.up=function(){return this.dragging=!1,this.panPlane=null},t.prototype.drag=function(t,e,i){var n,r;if(this.dragging)return i&&this.panPlane?(this.dragPosWindow.set(t,e),this.clickPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.clickPosWindow.x,this.clickPosWindow.y,this.window.width,this.window.height)),this.dragPosPlane=this.panPlane.intersectRay(this.camera.getViewRay(this.dragPosWindow.x,this.dragPosWindow.y,this.window.width,this.window.height)),n=this.camera.getViewMatrix().dup().invert(),this.clickPosWorld=this.clickPosPlane.dup().transformMat4(n),this.dragPosWorld=this.dragPosPlane.dup().transformMat4(n),this.diffWorld=this.dragPosWorld.dup().sub(this.clickPosWorld),this.camera.setTarget(this.clickTarget.dup().sub(this.diffWorld)),this.updateCamera()):(this.dragPos=this.mouseToSphere(t,e),this.rotAxis.asCross(this.clickPos,this.dragPos),r=this.clickPos.dot(this.dragPos),this.dragRot.set(this.rotAxis.x,this.rotAxis.y,this.rotAxis.z,r),this.currRot.asMul(this.dragRot,this.clickRot)),this.updateCamera()},t.prototype.updateCamera=function(){var t,e,i,n,r;return i=this.currRot.clone(),i.w*=-1,n=this.camera.getTarget(),e=a.create(0,0,this.distance).transformQuat(i),t=a.create().asAdd(n,e),r=a.create(0,1,0).transformQuat(i),this.camera.lookAt(n,t,r)},t.prototype.disableZoom=function(){return this.allowZooming=!1},t.prototype.setDistance=function(t){return this.distance=t||2,this.minDistance=t/2||.3,this.maxDistance=2*t||5,this.updateCamera()},t}(),e.exports=i},{"pex-geom":24}],44:[function(t,e){var i,n,r,o,s,a,h,u,c,l,p,f;f=t("pex-geom"),u=f.Vec2,c=f.Vec3,l=f.Vec4,o=f.Edge,s=f.Face3,a=f.Face4,h=f.FacePolygon,n=t("pex-color").Color,r=t("./Context"),p=function(t,e){var i,n,r;for(n=0,r=e.length;r>n;n++)if(i=e[n],"undefined"==typeof t[i])return!1;return!0},i=function(){function t(t,e,i,n){this.gl=r.currentContext,this.target=t,this.type=e,this.usage=n||gl.STATIC_DRAW,this.dataBuf=null,i&&this.update(i,this.usage)}return t.prototype.dispose=function(){return this.gl.deleteBuffer(this.handle),this.handle=null},t.prototype.update=function(t,e){var i,n,r,o,s,a,h,u,c,l,f,d,g,m,x,v,y,w,b,E,M,T;if(this.handle||(this.handle=this.gl.createBuffer()),this.usage=e||this.usage,t&&0!==t.length){if(isNaN(t[0]))if(p(t[0],["x","y","z","w"]))for(this.dataBuf&&this.dataBuf.length===4*t.length||(this.dataBuf=new this.type(4*t.length),this.elementSize=4),r=u=0,d=t.length;d>u;r=++u)a=t[r],this.dataBuf[4*r+0]=a.x,this.dataBuf[4*r+1]=a.y,this.dataBuf[4*r+2]=a.z,this.dataBuf[4*r+3]=a.w;else if(p(t[0],["x","y","z"]))for(this.dataBuf&&this.dataBuf.length===3*t.length||(this.dataBuf=new this.type(3*t.length),this.elementSize=3),r=c=0,g=t.length;g>c;r=++c)a=t[r],this.dataBuf[3*r+0]=a.x,this.dataBuf[3*r+1]=a.y,this.dataBuf[3*r+2]=a.z;else if(p(t[0],["x","y"]))for(this.dataBuf&&this.dataBuf.length===2*t.length||(this.dataBuf=new this.type(2*t.length),this.elementSize=2),r=l=0,m=t.length;m>l;r=++l)a=t[r],this.dataBuf[2*r+0]=a.x,this.dataBuf[2*r+1]=a.y;else if(p(t[0],["r","g","b","a"]))for(this.dataBuf&&this.dataBuf.length===4*t.length||(this.dataBuf=new this.type(4*t.length),this.elementSize=4),r=b=0,x=t.length;x>b;r=++b)a=t[r],this.dataBuf[4*r+0]=a.r,this.dataBuf[4*r+1]=a.g,this.dataBuf[4*r+2]=a.b,this.dataBuf[4*r+3]=a.a;else if(2===t[0].length)for(this.dataBuf&&this.dataBuf.length===2*t.length||(this.dataBuf=new this.type(2*t.length),this.elementSize=1),r=E=0,v=t.length;v>E;r=++E)i=t[r],this.dataBuf[2*r+0]=i[0],this.dataBuf[2*r+1]=i[1];else if(t[0].length>=3){for(s=0,M=0,y=t.length;y>M;M++)if(n=t[M],3===n.length&&(s+=3),4===n.length&&(s+=6),n.length>4)throw"FacePolygons "+n.length+" + are not supported in RenderableGeometry Buffers";
for(this.dataBuf&&this.dataBuf.length===s||(this.dataBuf=new this.type(s),this.elementSize=1),o=0,T=0,w=t.length;w>T;T++)n=t[T],3===n.length&&(this.dataBuf[o+0]=n[0],this.dataBuf[o+1]=n[1],this.dataBuf[o+2]=n[2],o+=3),4===n.length&&(this.dataBuf[o+0]=n[0],this.dataBuf[o+1]=n[1],this.dataBuf[o+2]=n[3],this.dataBuf[o+3]=n[3],this.dataBuf[o+4]=n[1],this.dataBuf[o+5]=n[2],o+=6)}else console.log("Buffer.unknown type",t.name,t[0]);else for(this.dataBuf&&this.dataBuf.length===t.length||(this.dataBuf=new this.type(t.length)),r=h=0,f=t.length;f>h;r=++h)a=t[r],this.dataBuf[r]=a,this.elementSize=1;return this.gl.bindBuffer(this.target,this.handle),this.gl.bufferData(this.target,this.dataBuf,this.usage)}},t}(),e.exports=i},{"./Context":45,"pex-color":6,"pex-geom":24}],45:[function(t,e){var i=t("pex-sys"),n=null,r={};Object.defineProperty(r,"currentContext",{get:function(){return n?n:i.Window.currentWindow?i.Window.currentWindow.gl:null},set:function(t){n=t},enumerable:!0,configurable:!0}),e.exports=r},{"pex-sys":77}],46:[function(t,e){function i(t,e){this.gl=n.currentContext,this.program=t,this.uniforms=e||{},this.prevUniforms={},this.missingUniforms={}}var n=t("./Context");i.prototype.use=function(){this.program.use();var t=0;for(var e in this.program.uniforms)if(null==this.uniforms[e])-1==e.indexOf("[")&&(this.missingUniforms[e]||(this.missingUniforms[e]=0),this.missingUniforms[e]++,2==this.missingUniforms[e]&&console.log("WARN","Uniform",e,"is null"));else if(this.program.uniforms[e].type==this.gl.SAMPLER_2D||this.program.uniforms[e].type==this.gl.SAMPLER_CUBE)this.gl.activeTexture(this.gl.TEXTURE0+t),this.uniforms[e].width>0&&this.uniforms[e].height>0&&(this.gl.bindTexture(this.uniforms[e].target,this.uniforms[e].handle),this.program.uniforms[e](t)),t++;else{var i=this.uniforms[e],n=this.prevUniforms[e],r=null;if(null!==n)if(i&&i.hash){if(r=i.hash(),r==n)continue}else if(i==n)continue;this.program.uniforms[e](this.uniforms[e]),this.prevUniforms[e]=r?r:i}},e.exports=i},{"./Context":45}],47:[function(t,e){function i(t,e,i){this.gl=o.currentContext,this.geometry=n(t,s),this.material=e,i=i||{},this.primitiveType=i.primitiveType,null==this.primitiveType&&(this.primitiveType=this.gl.TRIANGLES),i.lines&&(this.primitiveType=this.gl.LINES),i.triangles&&(this.primitiveType=this.gl.TRIANGLES),i.points&&(this.primitiveType=this.gl.POINTS),this.position=a.create(0,0,0),this.rotation=h.create(),this.scale=a.create(1,1,1),this.projectionMatrix=u.create(),this.viewMatrix=u.create(),this.invViewMatrix=u.create(),this.modelWorldMatrix=u.create(),this.modelViewMatrix=u.create(),this.rotationMatrix=u.create(),this.normalMatrix=u.create()}var n=t("merge"),r=t("pex-geom"),o=t("./Context"),s=t("./RenderableGeometry"),a=r.Vec3,h=r.Quat,u=r.Mat4,c=r.BoundingBox;i.extensions={},i.prototype.draw=function(t){this.geometry.isDirty()&&this.geometry.compile(),t&&(this.updateMatrices(t),this.updateMatricesUniforms(this.material)),this.material.use();var e=this.bindAttribs();if(e>0){var n;if(this.gl.drawElementsInstanced&&(n=this.gl.drawElementsInstanced.bind(this.gl)),!n){if(!i.extensions.instancedArrays&&(i.extensions.instancedArrays=this.gl.getExtension("ANGLE_instanced_arrays"),!i.extensions.instancedArrays))throw"Mesh has instanced geometry but ANGLE_instanced_arrays is not available";n=i.extensions.instancedArrays.drawElementsInstancedANGLE.bind(i.extensions.instancedArrays)}this.geometry.faces&&this.geometry.faces.length>0&&this.primitiveType!==this.gl.LINES&&this.primitiveType!==this.gl.POINTS?(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle),n(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0,e)):this.geometry.edges&&this.geometry.edges.length>0&&this.primitiveType===this.gl.LINES&&(this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle),n(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0,e))}else if(this.geometry.faces&&this.geometry.faces.length>0&&this.primitiveType!==this.gl.LINES&&this.primitiveType!==this.gl.POINTS)this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle),this.gl.drawElements(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0);else if(this.geometry.edges&&this.geometry.edges.length>0&&this.primitiveType===this.gl.LINES)this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle),this.gl.drawElements(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0);else if(this.geometry.vertices){var r=this.geometry.vertices.length;this.gl.drawArrays(this.primitiveType,0,r)}this.unbindAttribs()},i.prototype.drawInstances=function(t,e){if(this.geometry.isDirty()&&this.geometry.compile(),t&&(this.updateMatrices(t),this.updateMatricesUniforms(this.material)),this.material.use(),this.bindAttribs(),this.geometry.faces&&this.geometry.faces.length>0&&!this.useEdges){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.faces.buffer.handle);for(var i=0;i<e.length;i++){var n=e[i];t&&(this.updateMatrices(t,n),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,n),this.material.use()),this.gl.drawElements(this.primitiveType,this.geometry.faces.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0)}}else if(this.geometry.edges&&this.useEdges){this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.geometry.edges.buffer.handle);for(var i=0;i<e.length;i++){var n=e[i];t&&(this.updateMatrices(t,n),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,n),this.material.use()),this.gl.drawElements(this.primitiveType,this.geometry.edges.buffer.dataBuf.length,this.gl.UNSIGNED_SHORT,0)}}else if(this.geometry.vertices)for(var r=this.geometry.vertices.length,i=0;i<e.length;i++){var n=e[i];t&&(this.updateMatrices(t,n),this.updateMatricesUniforms(this.material),this.updateUniforms(this.material,n),this.material.use()),this.gl.drawArrays(this.primitiveType,0,r)}return this.unbindAttribs()},i.prototype.bindAttribs=function(){var t=0,e=this.material.program;for(name in this.geometry.attribs){var i=this.geometry.attribs[name];i.location=this.gl.getAttribLocation(e.handle,i.name),i.location>=0&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,i.buffer.handle),this.gl.vertexAttribPointer(i.location,i.buffer.elementSize,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(i.location),i.instanced&&(this.vertexAttribDivisor(i.location,1),t=i.length))}return t},i.prototype.unbindAttribs=function(){for(name in this.geometry.attribs){var t=this.geometry.attribs[name];t.location>=0&&(t.instanced&&this.vertexAttribDivisor(t.location,0),this.gl.disableVertexAttribArray(t.location))}},i.prototype.vertexAttribDivisor=function(t,e){if(this.gl.vertexAttribDivisor)this.gl.vertexAttribDivisor(t,e);else{if(!i.extensions.instancedArrays&&(i.extensions.instancedArrays=this.gl.getExtension("ANGLE_instanced_arrays"),!i.extensions.instancedArrays))throw"Mesh has instanced geometry but ANGLE_instanced_arrays is not available";i.extensions.instancedArrays.vertexAttribDivisorANGLE(t,e)}},i.prototype.resetAttribLocations=function(){for(name in this.geometry.attribs){var t=this.geometry.attribs[name];t.location=-1}},i.prototype.updateMatrices=function(t,e){var i=e&&e.position?e.position:this.position,n=e&&e.rotation?e.rotation:this.rotation,r=e&&e.scale?e.scale:this.scale;return n.toMat4(this.rotationMatrix),this.modelWorldMatrix.identity().translate(i.x,i.y,i.z).mul(this.rotationMatrix).scale(r.x,r.y,r.z),t?(this.projectionMatrix.copy(t.getProjectionMatrix()),this.viewMatrix.copy(t.getViewMatrix()),this.invViewMatrix.copy(t.getViewMatrix().dup().invert()),this.modelViewMatrix.copy(t.getViewMatrix()).mul(this.modelWorldMatrix),this.normalMatrix.copy(this.modelViewMatrix).invert().transpose()):void 0},i.prototype.updateUniforms=function(t,e){for(uniformName in e.uniforms){var i=e.uniforms[uniformName];t.uniforms[uniformName]=i}},i.prototype.updateMatricesUniforms=function(){var t,e;return e=this.material.program.uniforms,t=this.material.uniforms,e.projectionMatrix&&(t.projectionMatrix=this.projectionMatrix),e.viewMatrix&&(t.viewMatrix=this.viewMatrix),e.invViewMatrix&&(t.invViewMatrix=this.invViewMatrix),e.modelWorldMatrix&&(t.modelWorldMatrix=this.modelWorldMatrix),e.modelViewMatrix&&(t.modelViewMatrix=this.modelViewMatrix),e.normalMatrix?t.normalMatrix=this.normalMatrix:void 0},i.prototype.getMaterial=function(){return this.material},i.prototype.setMaterial=function(t){return this.material=t,this.resetAttribLocations()},i.prototype.getProgram=function(){return this.material.program},i.prototype.setProgram=function(t){return this.material.program=t,this.resetAttribLocations()},i.prototype.dispose=function(){return this.geometry.dispose()},i.prototype.getBoundingBox=function(){return this.boundingBox||this.updateBoundingBox(),this.boundingBox},i.prototype.updateBoundingBox=function(){return this.updateMatrices(),this.boundingBox=c.fromPoints(this.geometry.vertices.map(function(t){return function(e){return e.dup().transformMat4(t.modelWorldMatrix)}}(this)))},e.exports=i},{"./Context":45,"./RenderableGeometry":52,merge:58,"pex-geom":24}],48:[function(t,e){var i,n,r,o,s,a,h;h=t("pex-geom"),o=h.Vec2,s=h.Vec3,a=h.Vec4,i=h.Mat4,r=h.Ray,n=function(){function t(t,e,n,r,o,a,h,u,c){var l,p,f,d;p=t,f=t+n,d=e,l=e+r,this.left=p,this.right=f,this.bottom=l,this.top=d,this.near=o||.1,this.far=a||100,this.position=h||s.create(0,0,5),this.target=u||s.create(0,0,0),this.up=c||s.create(0,1,0),this.projectionMatrix=i.create(),this.viewMatrix=i.create(),this.updateMatrices()}var e;return t.prototype.getFov=function(){return this.fov},t.prototype.getAspectRatio=function(){return this.aspectRatio},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getPosition=function(){return this.position},t.prototype.getTarget=function(){return this.target},t.prototype.getUp=function(){return this.up},t.prototype.getViewMatrix=function(){return this.viewMatrix},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.setFov=function(t){return this.fov=t,this.updateMatrices()},t.prototype.setAspectRatio=function(t){return this.aspectRatio=t,this.updateMatrices()},t.prototype.setFar=function(t){return this.far=t,this.updateMatrices()},t.prototype.setNear=function(t){return this.near=t,this.updateMatrices()},t.prototype.setPosition=function(t){return this.position=t,this.updateMatrices()},t.prototype.setTarget=function(t){return this.target=t,this.updateMatrices()},t.prototype.setUp=function(t){return this.up=t,this.updateMatrices()},t.prototype.lookAt=function(t,e,i){return t&&(this.target=t),e&&(this.position=e),i&&(this.up=i),this.updateMatrices()},t.prototype.updateMatrices=function(){return this.projectionMatrix.identity().ortho(this.left,this.right,this.bottom,this.top,this.near,this.far),this.viewMatrix.identity().lookAt(this.position,this.target,this.up)},e=a.create(),t.prototype.getScreenPos=function(t,i,n){var r;return e.set(t.x,t.y,t.z,1),e.transformMat4(this.viewMatrix),e.transformMat4(this.projectionMatrix),r=o.create().set(e.x,e.y),r.x/=e.w,r.y/=e.w,r.x=.5*r.x+.5,r.y=.5*r.y+.5,r.x*=i,r.y*=n,r},t.prototype.getWorldRay=function(t,e,i,n){var o,a,h,u,c,l,p,f;return t=(t-i/2)/(i/2),e=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),l=o*this.getAspectRatio(),t*=l/2,e*=o/2,h=new s(0,0,0),u=new s(t,e,-this.getNear()),a=this.getViewMatrix().dup().invert(),p=h.dup().transformMat4(a),f=u.dup().transformMat4(a),c=f.dup().sub(p),new r(p,c)},t}(),e.exports=n},{"pex-geom":24}],49:[function(t,e){var i,n,r,o,s,a,h;h=t("pex-geom"),o=h.Vec2,s=h.Vec3,a=h.Vec4,i=h.Mat4,r=h.Ray,n=function(){function t(t,e,n,r,o,a,h){this.fov=t||60,this.aspectRatio=e||4/3,this.near=n||.1,this.far=r||100,this.position=o||s.create(0,0,5),this.target=a||s.create(0,0,0),this.up=h||s.create(0,1,0),this.projectionMatrix=i.create(),this.viewMatrix=i.create(),this.updateMatrices()}var e;return t.prototype.getFov=function(){return this.fov},t.prototype.getAspectRatio=function(){return this.aspectRatio},t.prototype.getNear=function(){return this.near},t.prototype.getFar=function(){return this.far},t.prototype.getPosition=function(){return this.position},t.prototype.getTarget=function(){return this.target},t.prototype.getUp=function(){return this.up},t.prototype.getViewMatrix=function(){return this.viewMatrix},t.prototype.getProjectionMatrix=function(){return this.projectionMatrix},t.prototype.setFov=function(t){return this.fov=t,this.updateMatrices()},t.prototype.setAspectRatio=function(t){return this.aspectRatio=t,this.updateMatrices()},t.prototype.setFar=function(t){return this.far=t,this.updateMatrices()},t.prototype.setNear=function(t){return this.near=t,this.updateMatrices()},t.prototype.setPosition=function(t){return this.position=t,this.updateMatrices()},t.prototype.setTarget=function(t){return this.target=t,this.updateMatrices()},t.prototype.setUp=function(t){return this.up=t,this.updateMatrices()},t.prototype.lookAt=function(t,e,i){return t&&(this.target=t),e&&(this.position=e),i&&(this.up=i),this.updateMatrices()},t.prototype.updateMatrices=function(){return this.projectionMatrix.identity().perspective(this.fov,this.aspectRatio,this.near,this.far),this.viewMatrix.identity().lookAt(this.position,this.target,this.up)},e=a.create(),t.prototype.getScreenPos=function(t,i,n){var r;return e.set(t.x,t.y,t.z,1),e.transformMat4(this.viewMatrix),e.transformMat4(this.projectionMatrix),r=o.create().set(e.x,e.y),r.x/=e.w,r.y/=e.w,r.x=.5*r.x+.5,r.y=.5*r.y+.5,r.x*=i,r.y*=n,r},t.prototype.getViewRay=function(t,e,i,n){var o,a,h,u,c,l,p;return a=(t-i/2)/(i/2),h=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),p=o*this.getAspectRatio(),a*=p/2,h*=o/2,c=new s(0,0,0),l=new s(a,h,-this.getNear()),u=l.dup().sub(c).normalize(),new r(c,u)},t.prototype.getWorldRay=function(t,e,i,n){var o,a,h,u,c,l,p,f;return t=(t-i/2)/(i/2),e=-(e-n/2)/(n/2),o=2*Math.tan(this.getFov()/180*Math.PI/2)*this.getNear(),l=o*this.getAspectRatio(),t*=l/2,e*=o/2,h=new s(0,0,0),u=new s(t,e,-this.getNear()),a=this.getViewMatrix().dup().invert(),p=h.dup().transformMat4(a),f=u.dup().transformMat4(a),c=f.dup().sub(p),new r(p,c)},t}(),e.exports=n},{"pex-geom":24}],50:[function(t,e){function i(t,e){this.gl=n.currentContext,this.handle=this.gl.createProgram(),this.uniforms={},this.attributes={},this.addSources(t,e),this.ready=!1,this.vertShader&&this.fragShader&&this.link()}var n=t("./Context"),r=t("pex-sys"),o=r.IO,s="#ifdef GL_ES\nprecision highp float;\n#endif\n#define VERT\n",a="#ifdef GL_ES\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n#else\n  precision mediump float;\n#endif\n#endif\n#define FRAG\n";i.prototype.addSources=function(t,e){return null==e&&(e=t),t&&this.addVertexSource(t),e?this.addFragmentSource(e):void 0},i.prototype.addVertexSource=function(t){if(this.vertShader=this.gl.createShader(this.gl.VERTEX_SHADER),this.gl.shaderSource(this.vertShader,s+t+"\n"),this.gl.compileShader(this.vertShader),!this.gl.getShaderParameter(this.vertShader,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(this.vertShader))},i.prototype.addFragmentSource=function(t){if(this.fragShader=this.gl.createShader(this.gl.FRAGMENT_SHADER),this.gl.shaderSource(this.fragShader,a+t+"\n"),this.gl.compileShader(this.fragShader),!this.gl.getShaderParameter(this.fragShader,this.gl.COMPILE_STATUS))throw new Error(this.gl.getShaderInfoLog(this.fragShader))},i.prototype.link=function(){if(this.gl.attachShader(this.handle,this.vertShader),this.gl.attachShader(this.handle,this.fragShader),this.gl.linkProgram(this.handle),!this.gl.getProgramParameter(this.handle,this.gl.LINK_STATUS))throw new Error(this.gl.getProgramInfoLog(this.handle));for(var t=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_UNIFORMS),e=0;t>e;e++){var n=this.gl.getActiveUniform(this.handle,e);if(n.size>1)for(var r=0;r<n.size;r++){var o=n.name.replace(/\[\d+\]/,"["+r+"]"),s=this.gl.getUniformLocation(this.handle,o);this.uniforms[o]=i.makeUniformSetter(this.gl,n.type,s)}else{var s=this.gl.getUniformLocation(this.handle,n.name);this.uniforms[n.name]=i.makeUniformSetter(this.gl,n.type,s)}}for(var a=this.gl.getProgramParameter(this.handle,this.gl.ACTIVE_ATTRIBUTES),e=0;a>e;e++){n=this.gl.getActiveAttrib(this.handle,e);var s=this.gl.getAttribLocation(this.handle,n.name);this.attributes[n.name]=s}return this.ready=!0,this},i.prototype.use=function(){return i.currentProgram!==this.handle?(i.currentProgram=this.handle,this.gl.useProgram(this.handle)):void 0},i.prototype.dispose=function(){return this.gl.deleteShader(this.vertShader),this.gl.deleteShader(this.fragShader),this.gl.deleteProgram(this.handle)},i.load=function(t,e,n){var r;return r=new i,o.loadTextFile(t,function(i){return console.log("Program.Compiling "+t),r.addSources(i),r.link(),e&&e(),n&&n.autoreload?o.watchTextFile(t,function(e){var i;try{return r.gl.detachShader(r.handle,r.vertShader),r.gl.detachShader(r.handle,r.fragShader),r.addSources(e),r.link()}catch(n){return i=n,console.log("Program.load : failed to reload "+t),console.log(i)}}):void 0}),r},i.makeUniformSetter=function(t,e,i){var n=null;switch(e){case t.BOOL:case t.INT:n=function(e){return t.uniform1i(i,e)};break;case t.SAMPLER_2D:case t.SAMPLER_CUBE:n=function(e){return t.uniform1i(i,e)};break;case t.FLOAT:n=function(e){return t.uniform1f(i,e)};break;case t.FLOAT_VEC2:n=function(e){return t.uniform2f(i,e.x,e.y)};break;case t.FLOAT_VEC3:n=function(e){return t.uniform3f(i,e.x,e.y,e.z)};break;case t.FLOAT_VEC4:n=function(e){return null!=e.r&&t.uniform4f(i,e.r,e.g,e.b,e.a),null!=e.x?t.uniform4f(i,e.x,e.y,e.z,e.w):void 0};break;case t.FLOAT_MAT4:var r=new Float32Array(16);n=function(e){return r[0]=e.a11,r[1]=e.a21,r[2]=e.a31,r[3]=e.a41,r[4]=e.a12,r[5]=e.a22,r[6]=e.a32,r[7]=e.a42,r[8]=e.a13,r[9]=e.a23,r[10]=e.a33,r[11]=e.a43,r[12]=e.a14,r[13]=e.a24,r[14]=e.a34,r[15]=e.a44,t.uniformMatrix4fv(i,!1,r)}}return n?(n.type=e,n):function(){throw new Error("Unknown uniform type: "+e)}},e.exports=i},{"./Context":45,"pex-sys":77}],51:[function(t,e){function i(t,e,i){var s=this.gl=n.currentContext,a={color:!0,depth:!1};if(i=o(a,i),this.width=t,this.height=e,this.oldBinding=s.getParameter(s.FRAMEBUFFER_BINDING),this.handle=s.createFramebuffer(),s.bindFramebuffer(s.FRAMEBUFFER,this.handle),this.colorAttachments=[],this.colorAttachmentsPositions=[],this.depthAttachments=[],i.color===!0){var h=r.create(t,e,i);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,h.target,h.handle,0),this.colorAttachments.push(h),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0)}else void 0!==i.color.length&&i.color.length>0?i.color.forEach(function(t,e){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+e,t.target,t.handle,0),this.colorAttachments.push(t),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0+e)}.bind(this)):i.color!==!1&&(s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,i.color.target,i.color.handle,0),this.colorAttachments.push(i.color),this.colorAttachmentsPositions.push(s.COLOR_ATTACHMENT0));if(i.depth)if(i.depth===!0){var u=s.getParameter(s.RENDERBUFFER_BINDING);this.depthAttachments[0]={handle:s.createRenderbuffer()},s.bindRenderbuffer(s.RENDERBUFFER,this.depthAttachments[0].handle),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,this.width,this.height),s.bindRenderbuffer(s.RENDERBUFFER,u),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,this.depthAttachments[0].handle)}else this.depthAttachments[0]=i.depth,s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,this.depthAttachments[0].handle,0);this.checkFramebuffer(),this.checkExtensions(),s.bindFramebuffer(s.FRAMEBUFFER,this.oldBinding),this.oldBinding=null}var n=t("./Context"),r=t("./Texture2D"),o=t("merge"),s=t("pex-sys"),a=s.Platform;i.prototype.checkExtensions=function(){var t=this.gl;if(a.isBrowser&&this.colorAttachments.length>1&&(this.webglDrawBuffersExt=t.getExtension("WEBGL_draw_buffers"),!this.webglDrawBuffersExt))throw"RenderTarget creating multiple render targets:"+this.colorAttachments.length+" but WEBGL_draw_buffers is not available"},i.prototype.bind=function(){var t=this.gl;this.oldBinding=t.getParameter(t.FRAMEBUFFER_BINDING),t.bindFramebuffer(t.FRAMEBUFFER,this.handle),this.colorAttachmentsPositions.length>1&&(a.isBrowser?this.webglDrawBuffersExt.drawBuffersWEBGL(this.colorAttachmentsPositions):t.drawBuffers(this.colorAttachmentsPositions))},i.prototype.bindAndClear=function(){var t=this.gl;this.bind(),t.clearColor(0,0,0,1),t.clear(this.depthAttachments.length>0?t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT:t.COLOR_BUFFER_BIT)},i.prototype.unbind=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.oldBinding),this.oldBinding=null,this.colorAttachmentsPositions.length>1&&(a.isBrowser?this.webglDrawBuffersExt.drawBuffersWEBGL([t.COLOR_ATTACHMENT0]):t.drawBuffers([t.COLOR_ATTACHMENT0]))},i.prototype.checkFramebuffer=function(){var t=this.gl,e=t.checkFramebufferStatus(t.FRAMEBUFFER);switch(e){case t.FRAMEBUFFER_UNSUPPORTED:throw"Framebuffer is unsupported";case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Framebuffer incomplete attachment";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Framebuffer incomplete dimensions";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Framebuffer incomplete missing attachment"}},i.prototype.getColorAttachment=function(t){return t=t||0,this.colorAttachments[t]},i.prototype.getDepthAttachement=function(){return this.depthAttachments[0]},e.exports=i},{"./Context":45,"./Texture2D":55,merge:58,"pex-sys":77}],52:[function(t,e){var i,n,r,o,s;r=t("pex-geom").Geometry,n=t("./Context"),i=t("./Buffer"),s=["faces","edges","indices"],o={compile:function(){var t,e,r,o,a,h,u,c;null==this.gl&&(this.gl=n.currentContext),u=this.attribs;for(e in u)t=u[e],t.buffer||(o=t.dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,t.buffer=new i(this.gl.ARRAY_BUFFER,Float32Array,null,o),t.dirty=!0),t.dirty&&(t.buffer.update(t),t.dirty=!1);for(c=[],a=0,h=s.length;h>a;a++)r=s[a],this[r]?(this[r].buffer||(o=this[r].dynamic?this.gl.DYNAMIC_DRAW:this.gl.STATIC_DRAW,this[r].buffer=new i(this.gl.ELEMENT_ARRAY_BUFFER,Uint16Array,null,o),this[r].dirty=!0),this[r].dirty?(this[r].buffer.update(this[r]),c.push(this[r].dirty=!1)):c.push(void 0)):c.push(void 0);return c},dispose:function(){var t,e,i,n,r,o,a;o=this.attribs;for(e in o)t=o[e],t&&t.buffer&&t.buffer.dispose();for(a=[],n=0,r=s.length;r>n;n++)i=s[n],a.push(this[i]&&this[i].buffer?this[i].buffer.dispose():void 0);return a}},e.exports=o},{"./Buffer":44,"./Context":45,"pex-geom":24}],53:[function(t,e){function i(t,e,i,n,c,l,p){e=void 0!==e?e:0,i=void 0!==i?i:0,n=void 0!==n?n:1,c=void 0!==c?c:1,l=void 0!==l?l:1,p=void 0!==p?p:1,this.image=t;var f=new s(u),d={screenSize:r.create(l,p),pixelPosition:r.create(e,i),pixelSize:r.create(n,c),alpha:1};t&&(d.image=t);var g=new a(f,d),m=[new r(-1,1),new r(-1,-1),new r(1,-1),new r(1,1)],x=[new r(0,1),new r(0,0),new r(1,0),new r(1,1)],v=new o({vertices:m,texCoords:x,faces:!0});v.faces.push([0,1,2]),v.faces.push([0,2,3]),this.mesh=new h(v,g)}var n=t("pex-geom"),r=n.Vec2,o=n.Geometry,s=t("./Program"),a=t("./Material"),h=t("./Mesh"),u="#ifdef VERT\n\nattribute vec2 position;\nattribute vec2 texCoord;\nuniform vec2 screenSize;\nuniform vec2 pixelPosition;\nuniform vec2 pixelSize;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  float tx = position.x * 0.5 + 0.5; //-1 -> 0, 1 -> 1\n  float ty = -position.y * 0.5 + 0.5; //-1 -> 1, 1 -> 0\n  //(x + 0)/sw * 2 - 1, (x + w)/sw * 2 - 1\n  float x = (pixelPosition.x + pixelSize.x * tx)/screenSize.x * 2.0 - 1.0;  //0 -> -1, 1 -> 1\n  //1.0 - (y + h)/sh * 2, 1.0 - (y + h)/sh * 2\n  float y = 1.0 - (pixelPosition.y + pixelSize.y * ty)/screenSize.y * 2.0;  //0 -> 1, 1 -> -1\n  gl_Position = vec4(x, y, 0.0, 1.0);\n  vTexCoord = texCoord;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec2 vTexCoord;\nuniform sampler2D image;\nuniform float alpha;\n\nvoid main() {\n  gl_FragColor = texture2D(image, vTexCoord);\n  gl_FragColor.a *= alpha;\n}\n\n#endif";i.prototype.setAlpha=function(t){this.mesh.material.uniforms.alpha=t},i.prototype.setPosition=function(t){this.mesh.material.uniforms.pixelPosition=t},i.prototype.setSize=function(t){this.mesh.material.uniforms.pixelSize=t},i.prototype.setScreenSize=function(t){this.mesh.material.uniforms.screenSize=t},i.prototype.setBounds=function(t){this.mesh.material.uniforms.pixelPosition.x=t.x,this.mesh.material.uniforms.pixelPosition.y=t.y,this.mesh.material.uniforms.pixelSize.x=t.width,this.mesh.material.uniforms.pixelSize.y=t.height},i.prototype.setImage=function(t){this.image=t,this.mesh.material.uniforms.image=t},i.prototype.draw=function(t,e){var i=null;t&&(i=this.mesh.material.uniforms.image,this.mesh.material.uniforms.image=t);var n=null;e&&(n=this.mesh.getProgram(),this.mesh.setProgram(e)),this.mesh.draw(),n&&this.mesh.setProgram(n),i&&(this.mesh.material.uniforms.image=i)},e.exports=i},{"./Material":46,"./Mesh":47,"./Program":50,"pex-geom":24}],54:[function(t,e){function i(t){t&&this.init(t)}var n=t("./Context");i.RGBA32F=34836,i.prototype.init=function(t){this.gl=n.currentContext,this.target=t,this.handle=this.gl.createTexture()},i.prototype.bind=function(t){t=t?t:0,this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.target,this.handle)},e.exports=i},{"./Context":45}],55:[function(t,e){function i(){this.gl=s.currentContext,a.call(this,this.gl.TEXTURE_2D)}var n=t("pex-sys"),r=t("merge"),o=n.IO,s=t("./Context"),a=t("./Texture"),h=n.Platform;i.prototype=Object.create(a.prototype),i.create=function(t,e,n){var o=s.currentContext,a={repeat:!1,mipmap:!1,nearest:!1,internalFormat:o.RGBA,format:o.RGBA,type:o.UNSIGNED_BYTE};n=r(a,n),n.internalFormat=n.format,32==n.bpp&&(n.type=o.FLOAT);var h=new i;h.bind(),h.checkExtensions(n),o.texImage2D(o.TEXTURE_2D,0,n.internalFormat,t,e,0,n.format,n.type,null);var u=n.repeat?o.REPEAT:o.CLAMP_TO_EDGE,c=n.repeat?o.REPEAT:o.CLAMP_TO_EDGE,l=o.LINEAR,p=o.LINEAR;return n.nearest&&(l=o.NEAREST,p=o.NEAREST),n.mipmap&&(p=o.LINEAR_MIPMAP_LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,l),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,p),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,u),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,c),o.bindTexture(o.TEXTURE_2D,null),h.width=t,h.height=e,h.target=o.TEXTURE_2D,h},i.prototype.checkExtensions=function(t){var e=this.gl;if(h.isBrowser){if(t.format==e.DEPTH_COMPONENT){var i=e.getExtension("WEBGL_depth_texture");if(!i)throw"Texture2D creating texture with format:gl.DEPTH_COMPONENT but WEBGL_depth_texture is not available"}if(t.type==e.FLOAT)if(h.isMobile){var n=e.getExtension("OES_texture_half_float");if(!n)throw"Texture2D creating texture with type:gl.FLOAT but OES_texture_half_float is not available";var r=e.getExtension("OES_texture_half_float_linear");if(!r)throw"Texture2D creating texture with type:gl.FLOAT but OES_texture_half_float_linear is not available";t.type=n.HALF_FLOAT_OES}else{var o=e.getExtension("OES_texture_float");if(!o)throw"Texture2D creating texture with type:gl.FLOAT but OES_texture_float is not available";var s=e.getExtension("OES_texture_float_linear");if(!s)throw"Texture2D creating texture with type:gl.FLOAT but OES_texture_float_linear is not available"}}},i.prototype.bind=function(t){t=t?t:0,this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,this.handle)},i.genNoise=function(t,e){t=t||256,e=e||256;var n=s.currentContext,r=new i;r.bind();for(var o=new ArrayBuffer(t*e*2),a=new Uint8Array(o),h=0;e>h;h++)for(var u=0;t>u;u++)a[h*t+u]=Math.floor(255*Math.random());return n.texImage2D(n.TEXTURE_2D,0,n.LUMINANCE,t,e,0,n.LUMINANCE,n.UNSIGNED_BYTE,a),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),r.width=t,r.height=e,r},i.genNoiseRGBA=function(t,e){t=t||256,e=e||256;var n=s.currentContext,r=n.createTexture();n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r);for(var o=new ArrayBuffer(t*e*4),a=new Uint8Array(o),h=0;e>h;h++)for(var u=0;t>u;u++)a[4*(h*t+u)+0]=h,a[4*(h*t+u)+1]=Math.floor(255*Math.random()),a[4*(h*t+u)+2]=Math.floor(255*Math.random()),a[4*(h*t+u)+3]=Math.floor(255*Math.random());n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,a),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!0),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null);var c=new i;return c.handle=r,c.width=t,c.height=e,c.target=n.TEXTURE_2D,c.gl=n,c},i.load=function(t,e,n){n||"function"!=typeof e||(n=e,e=null);var a={repeat:!1,mipmap:!1,nearest:!1,flip:!0};e=r(a,e);var h=s.currentContext,u=i.create(0,0,e);return u.ready=!1,o.loadImageData(h,u.handle,u.target,u.target,t,{flip:e.flip,crossOrigin:e.crossOrigin},function(t){if(!t){u.dispose();var r=i.getNoise();u.handle=r.handle,u.width=r.width,u.height=r.height}e.mipmap&&u.generateMipmap(),h.bindTexture(u.target,null),u.width=t.width,u.height=t.height,u.ready=!0,n&&n(u)}),u},i.prototype.dispose=function(){this.handle&&(this.gl.deleteTexture(this.handle),this.handle=null)},i.prototype.generateMipmap=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.handle),this.gl.generateMipmap(this.gl.TEXTURE_2D)},e.exports=i},{"./Context":45,"./Texture":54,merge:58,"pex-sys":77}],56:[function(t,e){function i(){this.gl=o.currentContext,s.call(this,this.gl.TEXTURE_CUBE_MAP)}var n=t("pex-sys"),r=n.IO,o=(n.Platform,t("./Context")),s=t("./Texture"),a=t("merge");i.prototype=Object.create(s.prototype),i.load=function(t,e,n){var s={mipmap:!1,nearest:!1};e=a(s,e);var h=o.currentContext,u=new i,c=[h.TEXTURE_CUBE_MAP_POSITIVE_X,h.TEXTURE_CUBE_MAP_NEGATIVE_X,h.TEXTURE_CUBE_MAP_POSITIVE_Y,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,h.TEXTURE_CUBE_MAP_POSITIVE_Z,h.TEXTURE_CUBE_MAP_NEGATIVE_Z],l=h.LINEAR,p=h.LINEAR;e.nearest&&(p=h.NEAREST,l=h.NEAREST),(e.mipmap||t.length>6)&&(l=h.LINEAR_MIPMAP_LINEAR),h.bindTexture(u.target,u.handle),h.texParameteri(u.target,h.TEXTURE_MAG_FILTER,p),h.texParameteri(u.target,h.TEXTURE_MIN_FILTER,l),h.texParameteri(u.target,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(u.target,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),u.ready=!1;for(var f=0,d=0;d<t.length;d++)r.loadImageData(h,u.handle,u.target,c[d%6],t[d],{flip:!1,lod:Math.floor(d/6)},function(i){u.width=i.width,u.height=i.height,++f==t.length&&(e.mipmap&&(h.bindTexture(u.target,u.handle),h.generateMipmap(u.target)),u.ready=!0,n&&n(u))});return u},i.prototype.dispose=function(){this.handle&&(this.gl.deleteTexture(this.handle),this.handle=null)},e.exports=i},{"./Context":45,"./Texture":54,merge:58,"pex-sys":77}],57:[function(t,e){var i=t("./Context");e.exports.getCurrentContext=function(){return i.currentContext},e.exports.clearColor=function(t){var e=i.currentContext;return t&&e.clearColor(t.r,t.g,t.b,t.a),e.clear(e.COLOR_BUFFER_BIT),this},e.exports.clearDepth=function(){var t=i.currentContext;return t.clear(t.DEPTH_BUFFER_BIT),this},e.exports.clearColorAndDepth=function(t){var e=i.currentContext;return t=t||{r:0,g:0,b:0,a:1},e.clearColor(t.r,t.g,t.b,t.a),e.depthMask(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this},e.exports.enableDepthReadAndWrite=function(t,e){2==arguments.length||(1==arguments.length?e=t:(t=!0,e=!0));var n=i.currentContext;return n.depthMask(e?1:0),t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this},e.exports.enableAdditiveBlending=function(){return this.enableBlending("ONE","ONE")},e.exports.enableAlphaBlending=function(){return this.enableBlending("SRC_ALPHA","ONE_MINUS_SRC_ALPHA")},e.exports.enableBlending=function(t,e){var n=i.currentContext;
return t===!1?(n.disable(n.BLEND),this):(n.enable(n.BLEND),n.blendFunc(n[t],n[e]),this)},e.exports.viewport=function(t,e,n,r){var o=i.currentContext;return o.viewport(t,e,n,r),this},e.exports.scissor=function(t,e,n,r){var o=i.currentContext;if(t===!1)o.disable(o.SCISSOR_TEST);else if(null!=t.width){var s=t;o.enable(o.SCISSOR_TEST),o.scissor(s.x,s.y,s.width,s.height)}else o.enable(o.SCISSOR_TEST),o.scissor(t,e,n,r);return this},e.exports.cullFace=function(t){t=void 0!==t?t:!0;var e=i.currentContext;return t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.cullFace(e.BACK),this},e.exports.lineWidth=function(t){var e=i.currentContext;return e.lineWidth(t),this}},{"./Context":45}],58:[function(t,e){!function(t){function i(t,e){if("object"!==r(t))return e;for(var n in e)t[n]="object"===r(t[n])&&"object"===r(e[n])?i(t[n],e[n]):e[n];return t}function n(t,e,n){var s=n[0],a=n.length;(t||"object"!==r(s))&&(s={});for(var h=0;a>h;++h){var u=n[h],c=r(u);if("object"===c)for(var l in u){var p=t?o.clone(u[l]):u[l];s[l]=e?i(s[l],p):p}}return s}function r(t){return{}.toString.call(t).slice(8,-1).toLowerCase()}var o=function(t){return n(t===!0,!1,arguments)},s="merge";o.recursive=function(t){return n(t===!0,!0,arguments)},o.clone=function(t){var e,i,n=t,s=r(t);if("array"===s)for(n=[],i=t.length,e=0;i>e;++e)n[e]=o.clone(t[e]);else if("object"===s){n={};for(e in t)n[e]=o.clone(t[e])}return n},t?e.exports=o:window[s]=o}("object"==typeof e&&e&&"object"==typeof e.exports&&e.exports)},{}],59:[function(t,e){e.exports.SolidColor=t("./lib/SolidColor"),e.exports.ShowNormals=t("./lib/ShowNormals"),e.exports.ShowColors=t("./lib/ShowColors"),e.exports.ShowPosition=t("./lib/ShowPosition"),e.exports.ShowTexCoords=t("./lib/ShowTexCoords"),e.exports.Textured=t("./lib/Textured"),e.exports.TexturedTriPlanar=t("./lib/TexturedTriPlanar"),e.exports.TexturedCubeMap=t("./lib/TexturedCubeMap"),e.exports.TexturedEnvMap=t("./lib/TexturedEnvMap"),e.exports.SkyBox=t("./lib/SkyBox"),e.exports.SkyBoxEnvMap=t("./lib/SkyBoxEnvMap"),e.exports.FlatToonShading=t("./lib/FlatToonShading"),e.exports.MatCap=t("./lib/MatCap"),e.exports.Diffuse=t("./lib/Diffuse"),e.exports.BlinnPhong=t("./lib/BlinnPhong"),e.exports.ShowDepth=t("./lib/ShowDepth")},{"./lib/BlinnPhong":60,"./lib/Diffuse":61,"./lib/FlatToonShading":62,"./lib/MatCap":63,"./lib/ShowColors":64,"./lib/ShowDepth":65,"./lib/ShowNormals":66,"./lib/ShowPosition":67,"./lib/ShowTexCoords":68,"./lib/SkyBox":69,"./lib/SkyBoxEnvMap":70,"./lib/SolidColor":71,"./lib/Textured":72,"./lib/TexturedCubeMap":73,"./lib/TexturedEnvMap":74,"./lib/TexturedTriPlanar":75}],60:[function(t,e){function i(t){this.gl=s.currentContext;var e=new h(p),i={wrap:0,pointSize:1,lightPos:c.create(10,20,30),ambientColor:u.create(0,0,0,1),diffuseColor:u.create(.9,.9,.9,1),specularColor:u.create(1,1,1,1),shininess:256,useBlinnPhong:!0};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,u=r.Color,c=o.Vec3,l=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelWorldMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nuniform vec3 lightPos;\nuniform vec3 cameraPos;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vEyePos;\n\nvoid main() {\n  vec4 worldPos = modelWorldMatrix * vec4(position, 1.0);\n  vec4 eyePos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * eyePos;\n  vEyePos = eyePos.xyz;\n  gl_PointSize = pointSize;\n  vNormal = (normalMatrix * vec4(normal, 0.0)).xyz;\n  vLightPos = (viewMatrix * vec4(lightPos, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 ambientColor;\nuniform vec4 diffuseColor;\nuniform vec4 specularColor;\nuniform float shininess;\nuniform float wrap;\nuniform bool useBlinnPhong;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vEyePos;\n\nfloat phong(vec3 L, vec3 E, vec3 N) {\n  vec3 R = reflect(-L, N);\n  return max(0.0, dot(R, E));\n}\n\nfloat blinnPhong(vec3 L, vec3 E, vec3 N) {\n  vec3 halfVec = normalize(L + E);\n  return max(0.0, dot(halfVec, N));\n}\n\nvoid main() {\n  vec3 L = normalize(vLightPos - vEyePos); //lightDir\n  vec3 E = normalize(-vEyePos); //viewDir\n  vec3 N = normalize(vNormal); //normal\n\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  vec4 color = ambientColor + NdotL * diffuseColor;\n\n  float specular = 0.0;\n  if (useBlinnPhong)\n    specular = blinnPhong(L, E, N);\n  else\n    specular = phong(L, E, N);\n\n  color += max(pow(specular, shininess), 0.0) * specularColor;\n\n  gl_FragColor = color;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-geom":24,"pex-glu":42}],61:[function(t,e){function i(t){this.gl=s.currentContext;var e=new h(p),i={wrap:0,pointSize:1,lightPos:c.create(10,20,30),ambientColor:u.create(0,0,0,1),diffuseColor:u.create(1,1,1,1)};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,u=r.Color,c=o.Vec3,l=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform mat4 viewMatrix;\nuniform float pointSize;\nuniform vec3 lightPos;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vPosition;\n\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n  vLightPos = (viewMatrix * vec4(lightPos, 1.0)).xyz;\n  vPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 ambientColor;\nuniform vec4 diffuseColor;\nuniform float wrap;\nvarying vec3 vNormal;\nvarying vec3 vLightPos;\nvarying vec3 vPosition;\n\nvoid main() {\n  vec3 L = normalize(vLightPos - vPosition);\n  vec3 N = normalize(vNormal);\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  gl_FragColor = ambientColor + NdotL * diffuseColor;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-geom":24,"pex-glu":42}],62:[function(t,e){function i(t){this.gl=s.currentContext.gl;var e=new h(l),i={wrap:1,pointSize:1,lightPos:u.create(10,20,30)},t=c(i,t);a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,u=(r.Color,o.Vec3),c=t("merge"),l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vNormal = normal;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec3 lightPos;\nuniform sampler2D colorBands;\nuniform float wrap;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 L = normalize(lightPos);\n  vec3 N = normalize(vNormal);\n  float NdotL = max(0.0, (dot(N, L) + wrap) / (1.0 + wrap));\n  gl_FragColor.rgb = N*0.5 + vec3(0.5);\n  gl_FragColor.rgb = vec3(NdotL);\n  gl_FragColor.a = 1.0;\n\n  gl_FragColor = texture2D(colorBands, vec2(NdotL, 0.5));\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-geom":24,"pex-glu":42}],63:[function(t,e){function i(t){this.gl=o.currentContext;var e=new a(u),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\n\nvarying vec3 e;\nvarying vec3 n;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\n  e = normalize(vec3(modelViewMatrix * vec4(position, 1.0)));\n  n = normalize(vec3(normalMatrix * vec4(normal, 1.0)));\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\n\nvarying vec3 e;\nvarying vec3 n;\n\nvoid main() {\n  vec3 r = (reflect(e, n));\n  float m = 2.0 * sqrt(r.x * r.x + r.y * r.y + (r.z + 1.0) * (r.z + 1.0));\n  vec2 N = r.xy / m + 0.5;\n  vec3 base = texture2D( texture, N ).rgb;\n  gl_FragColor = vec4( base, 1.0 );\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-glu":42}],64:[function(t,e){function i(t){this.gl=o.currentContext;var e=new a(u),i={pointSize:1};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec4 color;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = color;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-glu":42}],65:[function(t,e){function i(t){this.gl=s.currentContext;var e=new h(c),i={near:0,far:10};t=u(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,u=(r.Color,o.Vec3,t("merge")),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\n\nattribute vec3 position;\n\n//position in eye space coordinates (camera space, view space)\nvarying vec3 ecPosition;\n\nvoid main() {\n  vec4 ecPos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * ecPos;\n\n  ecPosition = ecPos.xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec3 ecPosition;\nuniform float near;\nuniform float far;\n\n//Z in Normalized Device Coordinates\n//http://www.songho.ca/opengl/gl_projectionmatrix.html\nfloat eyeSpaceDepthToNDC(float zEye) {\n  float A = -(far + near) / (far - near); //projectionMatrix[2].z\n  float B = -2.0 * far * near / (far - near); //projectionMatrix[3].z; //\n\n  float zNDC = (A * zEye + B) / -zEye;\n  return zNDC;\n}\n\n//depth buffer encoding\n//http://stackoverflow.com/questions/6652253/getting-the-true-z-value-from-the-depth-buffer\nfloat ndcDepthToDepthBuf(float zNDC) {\n  return 0.5 * zNDC + 0.5;\n}\n\nvoid main() {\n  float zEye = ecPosition.z;\n  float zNDC = eyeSpaceDepthToNDC(zEye);\n  float zBuf = ndcDepthToDepthBuf(zNDC);\n\n  gl_FragColor = vec4(zBuf);\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-geom":24,"pex-glu":42}],66:[function(t,e){function i(t){this.gl=o.currentContext;var e=new a(u),i={pointSize:1};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec4 vColor;\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vec3 N = normalize((normalMatrix * vec4(normal, 1.0)).xyz);\n  vColor = vec4(N * 0.5 + 0.5, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-glu":42}],67:[function(t,e){function i(t){this.gl=s.currentContext;var e=new h(c),i={};t=u(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,u=(r.Color,o.Vec3,t("merge")),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nvarying vec4 vColor;\nvoid main() {\n  vec4 pos = modelViewMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * pos;\n  vColor = pos;\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-geom":24,"pex-glu":42}],68:[function(t,e){function i(t){this.gl=s.currentContext;var e=new h(c),i={};t=u(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,u=(r.Color,o.Vec3,t("merge")),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\nattribute vec2 texCoord;\nvarying vec4 vColor;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n  vColor = vec4(texCoord, 0.0, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n\n#endif";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-geom":24,"pex-glu":42}],69:[function(t,e){function i(t){this.gl=o.currentContext;var e=new a(u),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = position * vec3(1.0, 1.0, 1.0);\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform samplerCube texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  gl_FragColor = textureCube(texture, N);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-glu":42}],70:[function(t,e){function i(t){this.gl=o.currentContext;var e=new a(u),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = position;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  vec2 texCoord = vec2((1.0 + atan(-N.z, N.x)/3.14159265359)/2.0, acos(-N.y)/3.14159265359);\n\n  gl_FragColor = texture2D(texture, texCoord);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-glu":42}],71:[function(t,e){function i(t){this.gl=o.currentContext;var e=new a(c),i={color:h.create(1,1,1,1),pointSize:1,premultiplied:0};t=u(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=r.Color,u=t("merge"),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform float pointSize;\nattribute vec3 position;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  gl_PointSize = pointSize;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform vec4 color;\nuniform bool premultiplied;\n\nvoid main() {\n  gl_FragColor = color;\n  if (premultiplied) {\n    gl_FragColor.rgb *= color.a;\n  }\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-glu":42}],72:[function(t,e){function i(t){this.gl=s.currentContext;var e=new h(p),i={scale:new c(1,1),color:new u(1,1,1,1),offset:new c(0,0)};t=l(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,u=r.Color,c=o.Vec2,l=t("merge"),p="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 offset;\nattribute vec3 position;\nattribute vec2 texCoord;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vTexCoord = texCoord;\n  vTexCoord += offset;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nuniform vec2 scale;\nuniform vec4 color;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_FragColor = texture2D(texture, vTexCoord * scale) * color;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-geom":24,"pex-glu":42}],73:[function(t,e){function i(t){this.gl=s.currentContext,c.isBrowser?(this.lodExt=this.gl.getExtension("EXT_shader_texture_lod"),this.lodExt&&(l="#define LOD_ENABLED 1\n"+l,l="#define WEBGL 1\n"+l,l="#define textureCubeLod textureCubeLodEXT\n"+l)):l="#define LOD_ENABLED 1\n"+l;var e=new h(l),i={lod:-1};t=u(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-sys"),s=n.Context,a=n.Material,h=n.Program,u=(r.Color,t("merge")),c=o.Platform,l="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\n\nattribute vec3 position;\nattribute vec3 normal;\n\nvarying vec3 ecNormal;\nvarying vec3 ecPos;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  ecPos = (modelViewMatrix * vec4(position, 1.0)).xyz;\n  ecNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\n#ifdef LOD_ENABLED\n#ifdef WEBGL\n  #extension GL_EXT_shader_texture_lod : require\n#else\n  #extension GL_ARB_shader_texture_lod : require\n#endif\n#endif\n\nuniform mat4 invViewMatrix;\n\nuniform samplerCube texture;\nuniform float lod;\nvarying vec3 ecNormal;\nvarying vec3 ecPos;\n\nvoid main() {\n  vec3 eyeDir = normalize(ecPos); //Direction to eye = camPos (0,0,0) - ecPos\n  vec3 ecN = normalize(ecNormal);\n  vec3 ecReflected = reflect(eyeDir, ecN); //eye coordinates reflection vector\n  vec3 wcReflected = vec3(invViewMatrix * vec4(ecReflected, 0.0)); //world coordinates reflection vector\n\n  #ifdef LOD_ENABLED\n  gl_FragColor = textureCubeLod(texture, wcReflected, lod);\n  #else\n  gl_FragColor = textureCube(texture, wcReflected);\n  #endif\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-glu":42,"pex-sys":77}],74:[function(t,e){function i(t){this.gl=o.currentContext;var e=new a(u),i={};t=h(i,t),s.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=n.Context,s=n.Material,a=n.Program,h=(r.Color,t("merge")),u="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 normalMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 vNormal;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  vNormal = (normalMatrix * vec4(normal, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nvarying vec3 vNormal;\n\nvoid main() {\n  vec3 N = normalize(vNormal);\n  vec2 texCoord = vec2((1.0 + atan(-N.z, N.x)/3.14159265359)/2.0, acos(-N.y)/3.14159265359);\n  gl_FragColor = texture2D(texture, texCoord);\n}\n\n#endif\n";i.prototype=Object.create(s.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-glu":42}],75:[function(t,e){function i(t){this.gl=s.currentContext;var e=new h(c),i={scale:1};t=u(i,t),a.call(this,e,t)}var n=t("pex-glu"),r=t("pex-color"),o=t("pex-geom"),s=n.Context,a=n.Material,h=n.Program,u=(r.Color,o.Vec3,t("merge")),c="#ifdef VERT\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelWorldMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nvarying vec3 wcNormal;\nvarying vec3 wcCoords;\n\nvoid main() {\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  wcNormal = normal; //this is not correct, shoud go from model -> world\n  wcCoords = (modelWorldMatrix * vec4(position, 1.0)).xyz;\n}\n\n#endif\n\n#ifdef FRAG\n\nuniform sampler2D texture;\nuniform float scale;\nvarying vec3 wcNormal;\nvarying vec3 wcCoords;\n\nvoid main() {\n  vec3 blending = abs( normalize(wcNormal) );\n  blending = normalize(max(blending, 0.00001)); // Force weights to sum to 1.0\n  float b = (blending.x + blending.y + blending.z);\n  blending /= vec3(b, b, b);\n\n  vec4 xaxis = texture2D( texture, wcCoords.zy * scale);\n  vec4 yaxis = texture2D( texture, wcCoords.xz * scale);\n  vec4 zaxis = texture2D( texture, wcCoords.xy * scale);\n  // blend the results of the 3 planar projections.\n  vec4 tex = xaxis * blending.x + yaxis * blending.y + zaxis * blending.z;\n\n  gl_FragColor = tex;\n}\n\n#endif\n";i.prototype=Object.create(a.prototype),e.exports=i},{merge:76,"pex-color":6,"pex-geom":24,"pex-glu":42}],76:[function(t,e,i){arguments[4][58][0].apply(i,arguments)},{dup:58}],77:[function(t,e){e.exports.Platform=t("./lib/Platform"),e.exports.Window=t("./lib/Window"),e.exports.Time=t("./lib/Time"),e.exports.IO=t("./lib/IO"),e.exports.Log=t("./lib/Log")},{"./lib/IO":79,"./lib/Log":80,"./lib/Platform":81,"./lib/Time":82,"./lib/Window":83}],78:[function(t,e){function i(t,e){for(var i=0;i<v.length;i++)v[i].eventType==t&&v[i].handler(e)}function n(t,e){r(t,e),o(t,e),s(t,e),a(t,e),h(t,e),u(t,e),c(t,e),l(t,e),p(t,e),f(t,e)}function r(t,e){t.addEventListener("mousedown",function(t){i("leftMouseDown",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*e.settings.highdpi,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*e.settings.highdpi,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function o(t,e){t.addEventListener("mouseup",function(t){i("leftMouseUp",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*e.settings.highdpi,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*e.settings.highdpi,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function s(t,e){var n=!1,r=0,o=0;t.addEventListener("mousedown",function(t){n=!0,r=(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*e.settings.highdpi,o=(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*e.settings.highdpi}),t.addEventListener("mouseup",function(){n=!1}),t.addEventListener("mousemove",function(t){if(n){var s=(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*e.settings.highdpi,a=(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*e.settings.highdpi;i("mouseDragged",{x:s,y:a,dx:s-r,dy:a-o,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey}),r=s,o=a}})}function a(t,e){t.addEventListener("mousemove",function(t){i("mouseMoved",{x:(t.offsetX||t.layerX||t.clientX-t.target.offsetLeft)*e.settings.highdpi,y:(t.offsetY||t.layerY||t.clientY-t.target.offsetTop)*e.settings.highdpi,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function h(t,e){var n=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";document.addEventListener(n,function(t){i("scrollWheel",{x:(t.offsetX||t.layerX)*e.settings.highdpi,y:(t.offsetY||t.layerY)*e.settings.highdpi,dy:t.wheelDelta/10||-t.detail/10,option:t.altKey,shift:t.shiftKey,control:t.ctrlKey})})}function u(t,e){t.addEventListener("touchstart",function(t){y={clientX:t.touches[0].clientX*e.settings.highdpi,clientY:t.touches[0].clientY*e.settings.highdpi};var n=Array.prototype.slice.call(this,t.touches).map(function(t){return t.x=t.clientX*e.settings.highdpi,t.y=t.clientY*e.settings.highdpi,t});i("leftMouseDown",{x:t.touches[0].clientX*e.settings.highdpi,y:t.touches[0].clientY*e.settings.highdpi,option:!1,shift:!1,control:!1,touches:n})})}function c(t,e){t.addEventListener("touchend",function(t){var n=Array.prototype.slice.call(this,t.touches).map(function(t){return t.x=t.clientX*e.settings.highdpi,t.y=t.clientY*e.settings.highdpi,t});i("leftMouseUp",{x:y?y.clientX:0,y:y?y.clientY:0,option:!1,shift:!1,control:!1,touches:n}),y=null})}function l(t,e){t.addEventListener("touchmove",function(t){t.preventDefault(),y={clientX:t.touches[0].clientX*e.settings.highdpi,clientY:t.touches[0].clientY*e.settings.highdpi};var n=Array.prototype.slice.call(this,t.touches).map(function(t){return t.x=t.clientX*e.settings.highdpi,t.y=t.clientY*e.settings.highdpi,t});return i("mouseDragged",{x:t.touches[0].clientX*e.settings.highdpi,y:t.touches[0].clientY*e.settings.highdpi,option:!1,shift:!1,control:!1,touches:n}),!1})}function p(){var t=0;window.addEventListener("keydown",function(e){t=setTimeout(function(){i("keyDown",{str:"",keyCode:e.keyCode,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey},1)})}),window.addEventListener("keypress",function(e){t&&(clearTimeout(t),t=0),i("keyDown",{str:String.fromCharCode(e.charCode),keyCode:e.keyCode,option:e.altKey,shift:e.shiftKey,control:e.ctrlKey})})}function f(t,e){window.addEventListener("resize",function(){var n=window.innerWidth,r=window.innerHeight;e.settings.fullscreen&&(t.width=n*e.settings.highdpi,t.height=r*e.settings.highdpi,t.style.width=n+"px",t.style.height=r+"px",e.width=n*e.settings.highdpi,e.height=r*e.settings.highdpi),i("resize",{width:n,height:r})})}function d(t){function e(){function e(){t.__disposed||(t.draw(),requestAnimFrame(e))}void 0===t.stencil&&(t.stencil=!1),t.settings.fullscreen&&(document.body.style.margin="0",document.body.style.padding="0",document.body.style.overflow="hidden");var r=null,o=null;if("3d"==t.settings.type){try{r=i.getContext("experimental-webgl",{antialias:!0,stencil:t.settings.stencil,premultipliedAlpha:t.settings.premultipliedAlpha,preserveDrawingBuffer:t.settings.preserveDrawingBuffer})}catch(s){return void m.error(s.message)}if(null===r)throw"No WebGL context is available."}else"2d"==t.settings.type&&(o=i.getContext("2d"));t.framerate=function(t){x=t},t.on=function(t,e){v.push({eventType:t,handler:e})},n(i,t),t.dispose=function(){t.__disposed=!0},t.gl=r,t.ctx=o,t.init(),requestAnimFrame(e)}var i=t.settings.canvas;return t.settings.fullscreen&&(t.settings.width=window.innerWidth,t.settings.height=window.innerHeight),i?t.settings.width&&t.settings.height?(i.width=t.settings.width,i.height=t.settings.height):(t.settings.width=i.width,t.settings.height=i.height):i=document.getElementById("canvas"),i||(i=document.createElement("canvas"),i.width=t.settings.width,i.height=t.settings.height),2==window.devicePixelRatio?2==t.settings.highdpi&&(i.width=2*t.settings.width,i.height=2*t.settings.height,i.style.width=t.settings.width+"px",i.style.height=t.settings.height+"px",t.settings.width=i.width,t.settings.height=i.height):t.settings.highdpi=1,t.settings.multisample&&(i.msaaEnabled=!0,i.msaaSamples=2),t.width=t.settings.width,t.height=t.settings.height,t.canvas=i,i.style.backgroundColor="#000000",i.parentNode?e():document.body?(document.body.appendChild(i),e()):window.addEventListener("load",function(){document.body.appendChild(i),e()},!1),t}var g=t("./Platform"),m=t("./Log"),x=(t("merge"),60);g.isBrowser&&(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/x)}}());var v=[],y=null,w={simpleWindow:d};e.exports=w},{"./Log":80,"./Platform":81,merge:84}],79:[function(t,e){(function(i){var n=t("./Platform"),r=t("./Log"),o=t("plask"),s=t("path"),a=t("merge"),h=function(){function t(){}return t.loadTextFile=function(e,i){var n=s.resolve(t.getWorkingDirectory(),e);if(!fs.existsSync(n)&&i)return i(null);var r=fs.readFileSync(n,"utf8");i&&i(r)},t.getWorkingDirectory=function(){return s.dirname(i.mainModule.filename)},t.loadImageData=function(e,i,n,r,h,u,c){var l={flip:!1,lod:0};u=a(l,u);var p=s.resolve(t.getWorkingDirectory(),h);e.activeTexture(e.TEXTURE0),e.bindTexture(n,i);var f=o.SkCanvas.createFromImage(p);u.flip?e.texImage2DSkCanvas(r,u.lod,f):e.texImage2DSkCanvasNoFlip(r,u.lod,f),c&&c(f)},t.watchTextFile=function(t,e){fs.watch(t,{},function(i){if("change"==i){var n=fs.readFileSync(t,"utf8");e&&e(n)}})},t.saveTextFile=function(t,e){fs.writeFileSync(t,e)},t},u=function(){function t(){}return t.getWorkingDirectory=function(){return"."},t.loadTextFile=function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onreadystatechange=function(){4==i.readyState&&(200==i.status?e&&e(i.responseText):r.error("WebIO.loadTextFile error : "+i.statusText))},i.send(null)},t.loadImageData=function(t,e,i,n,r,o,s){var h={flip:!1,lod:0};o=a(h,o);var u=new Image;o.crossOrigin&&(u.crossOrigin=o.crossOrigin),u.onload=function(){t.activeTexture(t.TEXTURE0),t.bindTexture(i,e),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flip),t.texImage2D(n,o.lod,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,u),s&&s(u)},u.src=r},t.watchTextFile=function(){console.log("Warning: WebIO.watch is not implemented!")},t.saveTextFile=function(t,e,i){var n=new XMLHttpRequest;n.open("POST",t,!0),n.onreadystatechange=function(){4==n.readyState&&(200==n.status?i&&i(n.responseText,n):r.error("WebIO.saveTextFile error : "+n.statusText))},n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.send("data="+encodeURIComponent(e))},t};n.isPlask?e.exports=h():n.isBrowser&&(e.exports=u())}).call(this,t("_process"))},{"./Log":80,"./Platform":81,_process:4,merge:84,path:3,plask:2}],80:[function(t,e){function i(){}i.message=function(){if(void 0!==console){var t=Array.prototype.slice.call(arguments);console.log(t.join(" "))}},i.error=function(){var t=Array.prototype.slice.call(arguments);void 0!==console&&console.log("ERROR: "+t.join(" "))},e.exports=i},{}],81:[function(t,e){(function(t){e.exports.isPlask="undefined"==typeof window&&"object"==typeof t,e.exports.isBrowser="object"==typeof window&&"object"==typeof document,e.exports.isEjecta="object"==typeof ejecta&&"function"==typeof ejecta.include,e.exports.isiOS=e.exports.isBrowser&&"object"==typeof navigator&&/(iPad|iPhone|iPod)/g.test(navigator.userAgent),e.exports.isMobile=e.exports.isiOS}).call(this,t("_process"))},{_process:4}],82:[function(t,e){var i=t("./Log"),n={now:0,prev:0,delta:0,seconds:0,frameNumber:0,fpsFrames:0,fpsTime:0,fps:0,fpsFrequency:3,paused:!1,verbose:!1};n.update=function(t){return n.paused?void 0:(0===n.prev&&(n.prev=Date.now()),n.now=Date.now(),n.delta=void 0!==t?t:(n.now-n.prev)/1e3,n.delta>1&&(n.delta=0),n.prev=n.now,n.seconds+=n.delta,n.fpsTime+=n.delta,n.frameNumber++,n.fpsFrames++,n.fpsTime>n.fpsFrequency&&(n.fps=n.fpsFrames/n.fpsTime,n.fpsTime=0,n.fpsFrames=0,this.verbose&&i.message("FPS: "+n.fps)),n.seconds)};var r=0;n.startMeasuringTime=function(){r=Date.now()},n.stopMeasuringTime=function(t){var e=Date.now(),i=(e-r)/1e3;return t&&console.log(t+i),i},n.pause=function(){n.paused=!0},n.togglePause=function(){n.paused=!n.paused},n.reset=function(){n.now=0,n.prev=0,n.delta=0,n.seconds=0,n.frameNumber=0,n.fpsFrames=0},e.exports=n},{"./Log":80}],83:[function(t,e){var i=t("./Platform"),n=t("./BrowserWindow"),r=t("./Time"),o=(t("./Log"),t("merge")),s=t("plask"),a={width:1280,height:720,type:"3d",vsync:!0,multisample:!0,fullscreen:!1,center:!0,highdpi:1,stencil:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,screen:0},h={currentWindow:null,create:function(t){if(t.settings=t.settings||{},t.settings=o(a,t.settings),t.settings.fullscreen){var e;if(e=i.isPlask?s.Window.screensInfo():[{width:window.innerWidth,height:window.innerHeight}],void 0!==t.settings.screen){var u=e[t.settings.screen];u&&(t.settings.position={x:0,y:u.height},t.settings.width=u.width*t.settings.highdpi,t.settings.height=u.height*t.settings.highdpi)}}t.__init=t.init,t.init=function(){h.currentWindow=this,t.framerate(60),t.__init&&t.__init()},t.__draw=t.draw,t.draw=function(){h.currentWindow=this,r.update(),t.__draw&&t.__draw()},i.isPlask?s.simpleWindow(t):(i.isBrowser||i.isEjecta)&&n.simpleWindow(t)}};e.exports=h},{"./BrowserWindow":78,"./Log":80,"./Platform":81,"./Time":82,merge:84,plask:2}],84:[function(t,e,i){arguments[4][58][0].apply(i,arguments)},{dup:58}]},{},[1]);